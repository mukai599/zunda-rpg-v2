
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>„Åö„Çì„Å†Ë±ÜÁü•Ë≠òRPG - ÁôæÂïèËÄê‰πÖÁ∑®„Å™„ÅÆ„Å†</title>
    <style>
        body { background-color: #f0f0f0; margin: 0; display: flex; justify-content: center; height: 100vh; overflow: hidden; font-family: sans-serif; }
        #game-container { width: 100%; max-width: 480px; height: 100%; background: #fff; border: 12px solid #7dc065; box-sizing: border-box; display: flex; flex-direction: column; position: relative; }
        #top-battle-area { background-color: #bce6f9; flex: 1.2; padding: 20px 15px 10px 15px; display: flex; flex-direction: column; align-items: center; position: relative; gap: 10px; }
        .status-pill { background: #fff; border: 3px solid #000; border-radius: 40px; padding: 5px 15px; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 0 rgba(0,0,0,0.1); width: 85%; max-width: 350px; }
        .hp-bg { flex: 1; height: 14px; background: #eee; border-radius: 7px; border: 2px solid #999; overflow: hidden; }
        .hp-fill { height: 100%; width: 100%; transition: width 0.3s, background-color 0.3s; background: #7dc065; }
        #main-action-view { flex: 1; display: flex; justify-content: center; align-items: center; padding: 10px; position: relative; width: 100%; }
        #main-illust { width: 100%; max-height: 200px; object-fit: contain; border: 3px solid #333; background: #fff; border-radius: 10px; }
        #combo-pop { position: absolute; top: 20%; left: 50%; transform: translateX(-50%); color: #ff9800; font-size: 40px; font-weight: bold; text-shadow: 3px 3px 0 #fff; opacity: 0; z-index: 100; transition: 0.3s; pointer-events: none; }
        #bottom-ui-area { flex: 1; background: #fff; border-top: 8px solid #7dc065; padding: 15px 20px; }
        #timer-bg { width: 100%; height: 18px; background: #eee; border: 3px solid #333; border-radius: 10px; overflow: hidden; margin-bottom: 10px; }
        #timer-bar { height: 100%; width: 100%; background: #f47b7b; }
        #question-box { background: #333; color: #fff; border-radius: 15px; padding: 15px; text-align: center; font-size: 16px; font-weight: bold; min-height: 70px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; line-height: 1.4; }
        .choice-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .choice-btn { background: #fff; border: 3px solid #7dc065; border-radius: 12px; padding: 12px; font-weight: bold; font-size: 14px; cursor: pointer; box-shadow: 0 4px 0 #5a9e43; }
        .full-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.98); z-index:2000; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; padding:20px; box-sizing:border-box; overflow-y: auto; }
        .big-btn { padding: 15px 40px; font-size: 20px; font-weight: bold; background: #7dc065; color: white; border: none; border-radius: 40px; cursor: pointer; box-shadow: 0 6px 0 #5a9e43; }
        #promo-box { border: 6px solid #f47b7b; border-radius: 15px; padding: 10px; background: #fff; margin: 10px 0; width: 100%; }
        .rank-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .rank-table th { background: #7dc065; color: white; padding: 5px; }
        .rank-table td { border-bottom: 1px solid #ddd; padding: 5px; font-weight: bold; }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0%{transform:translate(2px,2px)} 25%{transform:translate(-3px,-2px)} 50%{transform:translate(3px,2px)} 100%{transform:translate(0,0)} }
    </style>
</head>
<body>

<div id="game-container">
    <div id="start-screen" class="full-overlay">
        <img src="images/game_title.png" style="width:90%; margin-bottom:20px; border:4px solid #7dc065; border-radius:15px;">
        <button id="btn-start" class="big-btn">ÂÜíÈô∫ÈñãÂßã„Å™„ÅÆ„Å†ÔºÅ</button>
        <p style="font-size:14px; color:#7dc065; font-weight:bold; margin-top:15px;">Êïµ„ÅÆ„Éî„É≥„ÉÅ„ÇÇ„Åó„Å£„Åã„ÇäË¶ã„Åà„Çã„ÅÆ„Å†ÔºÅ</p>
    </div>

    <div id="result-screen" class="full-overlay" style="display:none;">
        <h2 style="margin:0;">ÁµêÊûúÁô∫Ë°®„Å™„ÅÆ„Å†ÔºÅ</h2>
        <div style="font-size:40px; font-weight:bold; color:#ff9800; margin:5px 0;"><span id="final-score">0</span>ÁÇπ</div>
        <div id="promo-box">
            <p style="color:#f47b7b; font-weight:bold; margin:0 0 5px 0;">„ÇÇ„Å£„Å®„Åö„Çì„Å†„ÇÇ„Çì„Åó„ÇÉ„Åπ„Çã„ÅÆ„Å†ÔºÅ</p>
            <a href="https://line.me/S/sticker/32533905" target="_blank">
                <img src="images/IMG_0294.PNG" style="width:100px; border-radius:5px;">
                <div style="background:#7dc065; color:white; padding:8px; border-radius:10px; margin-top:8px; font-weight:bold; font-size:14px;">„Çπ„Çø„É≥„Éó„ÇíË¶ã„Çã„ÅÆ„Å†ÔºÅ</div>
            </a>
        </div>
        <table class="rank-table"><thead><tr><th>‰Ωç</th><th>Âêç</th><th>ÁÇπ</th></tr></thead><tbody id="rank-body"></tbody></table>
        <button class="big-btn" onclick="location.reload()" style="background:#ffda44; color:#333; margin-top:15px;">„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÈÅä„Å∂</button>
    </div>

    <div id="top-battle-area">
        <div class="status-pill" style="align-self: flex-start;">
            <img id="enemy-thumb" src="images/enemy_weak.png" style="width:35px; height:35px; object-fit:contain;">
            <div class="hp-bg"><div id="enemy-hp-fill" class="hp-fill"></div></div>
        </div>
        <div id="main-action-view"><div id="combo-pop">0 COMBO!</div><img id="main-illust" src="images/gemini_zunda_think.png"></div>
        <div class="status-pill" style="align-self: flex-end;">
            <div class="hp-bg"><div id="player-hp-fill" class="hp-fill"></div></div>
            <img src="images/gemini_zunda_think.png" style="width:35px; height:35px; border-radius:50%; border:2px solid #7dc065;">
        </div>
    </div>

    <div id="bottom-ui-area">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <div id="btn-item" style="border:3px solid #7dc065; padding:4px 10px; border-radius:10px; cursor:pointer; background:#fff;">üç° x<span id="mochi-val">3</span></div>
            <div id="timer-bg" style="flex:1; margin:0 10px;"><div id="timer-bar"></div></div>
            <div style="font-weight:bold; color:#ff9800;">SCORE: <span id="score-val">0</span></div>
        </div>
        <div id="question-box"></div><div id="choices" class="choice-grid"></div>
    </div>
</div>

<script>
    const sounds = {
        bgm: new Audio('sounds/bgm_thinking.mp3'),
        result: new Audio('sounds/bgm_result.mp3'),
        ok: new Audio('sounds/se_correct.mp3'),
        ng: new Audio('sounds/se_damage.mp3'),
        tick: new Audio('sounds/se_tick.mp3'),
        heal: new Audio('sounds/se_heal.mp3'),
        defeat: new Audio('sounds/se_defeat.mp3'),
        comboSE: new Audio('sounds/se_combo.mp3'),
        vCombo1: new Audio('sounds/voice_combo1.mp3'),
        vCombo2: new Audio('sounds/voice_combo2.mp3'),
        vCombo3: new Audio('sounds/voice_combo3.mp3'),
        vCombo4: new Audio('sounds/voice_combo4.mp3'),
        vPromo: new Audio('sounds/voice_promo.mp3')
    };

    const masterQuizData = {
        weak: [
            {q:"„Éë„É≥„ÉÄ„ÅÆÂ∞ªÂ∞æ„ÅÆËâ≤„ÅØ‰ΩïËâ≤Ôºü", c:["Èªí","ÁôΩ","„Åó„Åæ"], a:1},
            {q:"„Ç§„ÉÅ„Ç¥„ÅÆË°®Èù¢„Å´„ÅÇ„ÇãÁ≤í„ÅÆÊ≠£‰Ωì„ÅØÔºü", c:["Á®Æ","ÊûúÂÆü","Ëåé"], a:1},
            {q:"„Éê„Éä„Éä„ÅØ„ÄåÊú®„Äç„Åß„ÅØ„Å™„Åè‰Ωï„ÅÆ‰ª≤ÈñìÔºü", c:["Ëçâ","„É§„Ç∑","„Çµ„Éú„ÉÜ„É≥"], a:0},
            {q:"„Çø„Ç≥„ÅÆÂøÉËáì„ÅØ„ÅÑ„Åè„Å§„ÅÇ„ÇãÔºü", c:["1„Å§","2„Å§","3„Å§"], a:2},
            {q:"„Ç≠„É™„É≥„ÅÆËßí„ÅØ‰ΩïÊú¨„ÅÇ„ÇãÔºü", c:["2Êú¨","3Êú¨","5Êú¨"], a:2},
            {q:"„Ç∑„Éû„Ç¶„Éû„ÅÆÂú∞ËÇå„ÅÆËâ≤„ÅØ‰ΩïËâ≤Ôºü", c:["ÁôΩ","Èªí","„Éî„É≥„ÇØ"], a:1},
            {q:"„Çª„Éü„ÅåÈ≥¥„Åè„ÅÆ„ÅØ„Å©„Å£„Å°Ôºü", c:["„Ç™„Çπ","„É°„Çπ","‰∏°Êñπ"], a:0},
            {q:"„Ç≥„Ç¢„É©„Åå1Êó•„Å´ÂØù„ÇãÊôÇÈñì„ÅØÔºü", c:["12h","18h","22h"], a:2},
            {q:"„É©„ÉÉ„Ç≥„ÅåÂØù„ÇãÊôÇ„Å´ÊµÅ„Åï„Çå„Å™„ÅÑÂ∑•Â§´„ÅØÔºü", c:["Â≤©„Çí„Å§„Åã„ÇÄ","Êµ∑Ëóª„ÇíÂ∑ª„Åè","Êâã„ÇíÁπã„Åê"], a:1},
            {q:"‰∏ñÁïå„Åß‰∏ÄÁï™ÈÄü„ÅÑÈ≥•„ÅØ„Å©„ÇåÔºü", c:["„Éè„É§„Éñ„Çµ","„ÉÄ„ÉÅ„Éß„Ç¶","„ÉÑ„Éê„É°"], a:0},
            {q:"„Éö„É≥„ÇÆ„É≥„ÅÆËÜù„ÅØ„ÄÅÂÆü„ÅØ„Å©„ÅÜ„Å™„Å£„Å¶„ÅÑ„ÇãÔºü", c:["„Å™„ÅÑ","Êõ≤„Åå„Å£„Å¶„ÅÑ„Çã","„Åæ„Å£„Åô„Åê"], a:1},
            {q:"„Ç´„É©„Çπ„ÅØËâ≤„ÇíË≠òÂà•„Åß„Åç„ÇãÔºü", c:["„Åß„Åç„Å™„ÅÑ","Â∞ë„Åó","‰∫∫Èñì„Çà„ÇäË¶ã„Åà„Çã"], a:2},
            {q:"„Éñ„É≠„ÉÉ„Ç≥„É™„Éº„Åß‰∏ÄÁï™Ê†ÑÈ§ä„Åå„ÅÇ„ÇãÈÉ®ÂàÜ„ÅØÔºü", c:["Ëåé","„Å§„Åº„Åø","Ëëâ"], a:0},
            {q:"Áå´„ÅÆËÄ≥„ÇíÂãï„Åã„ÅôÁ≠ãËÇâ„ÅØ‰∫∫Èñì„ÅÆ‰ΩïÂÄçÔºü", c:["3ÂÄç","10ÂÄç","30ÂÄç"], a:2},
            {q:"„Ç¢„É™„ÅÆÂπ≥ÂùáÁöÑ„Å™ÂØøÂëΩ„ÅØ„Å©„Çå„Åè„Çâ„ÅÑÔºü", c:["Êï∞ÈÄ±Èñì","1ÔΩû2Âπ¥","10Âπ¥‰ª•‰∏ä"], a:1},
            {q:"„Ç´„Çø„ÉÑ„É†„É™„Å´„ÅØÊ≠Ø„Åå„ÅÇ„ÇãÔºü", c:["„Å™„ÅÑ","100Êú¨„Åè„Çâ„ÅÑ","1‰∏áÊú¨‰ª•‰∏ä"], a:2},
            {q:"„Çµ„É°„ÅÆÈ™®„ÅØ‰Ωï„Åß„Åß„Åç„Å¶„ÅÑ„ÇãÔºü", c:["„Ç´„É´„Ç∑„Ç¶„É†","ËªüÈ™®","ÈâÑ"], a:1},
            {q:"„É©„Éï„É¨„Ç∑„Ç¢„ÅÆËä±„ÅÆÂåÇ„ÅÑ„ÅØÔºü", c:["Áîò„ÅÑ","ÁÑ°Ëá≠","ËÖê„Å£„ÅüËÇâ"], a:2},
            {q:"„Éí„Éû„ÉØ„É™„ÅØÂ§™ÈôΩ„Çí„Åö„Å£„Å®ËøΩ„ÅÑ„Åã„Åë„ÇãÔºü", c:["Ëã•„ÅÑÊôÇ„Å†„Åë","„Åö„Å£„Å®","ËøΩ„Çè„Å™„ÅÑ"], a:0},
            {q:"„ÉØ„Éã„ÅÆÊÄßÂà•„ÅØ‰Ωï„ÅßÊ±∫„Åæ„ÇãÔºü", c:["ÈÅ∫‰ºù","Âçµ„ÅÆÊôÇ„ÅÆÊ∏©Â∫¶","ÈÅã"], a:1},
            {q:"„Ç´„É≥„Ç¨„É´„Éº„ÅÆËµ§„Å°„ÇÉ„Çì„ÄÅÁîü„Åæ„Çå„ÅüÂ§ß„Åç„Åï„ÅØÔºü", c:["Á¥Ñ2cm","Á¥Ñ10cm","Á¥Ñ30cm"], a:0},
            {q:"„Ç´„É°„É¨„Ç™„É≥„ÅÆËâ≤„ÅåÂ§â„Çè„Çã‰∏ª„Å™ÁêÜÁî±„ÅØÔºü", c:["Èö†„Çå„Çã„Åü„ÇÅ","ÊÑüÊÉÖ„ÉªÊ∏©Â∫¶","Êì¨ÊÖã"], a:1},
            {q:"„Éï„ÇØ„É≠„Ç¶„ÅÆÈ¶ñ„ÅØ‰ΩïÂ∫¶„Åæ„ÅßÂõû„ÇãÔºü", c:["180Â∫¶","270Â∫¶","360Â∫¶"], a:1},
            {q:"„É©„Ç§„Ç™„É≥„ÅÆÁã©„Çä„Çí„Åô„Çã„ÅÆ„ÅØ‰∏ª„Å´„Å©„Å£„Å°Ôºü", c:["„Ç™„Çπ","„É°„Çπ","Â≠ê‰æõ"], a:1},
            {q:"Ë±°„Åå„Ç∏„É£„É≥„Éó„Åß„Åç„Å™„ÅÑÂîØ‰∏Ä„ÅÆÂì∫‰π≥È°ûÔºü", c:["Êú¨ÂΩì","Âòò","Á®ÆÈ°û„Å´„Çà„Çã"], a:0},
            {q:"„Éõ„ÉÉ„Ç≠„Éß„ÇØ„Ç∞„Éû„ÅÆÂú∞ËÇå„ÅÆËâ≤„ÅØ‰ΩïËâ≤Ôºü", c:["ÁôΩ","„Éî„É≥„ÇØ","Èªí"], a:2},
            {q:"„É™„Çπ„ÅØ„Å©„Çì„Åê„Çä„ÇíÂüã„ÇÅ„ÅüÂ†¥ÊâÄ„ÇíË¶ö„Åà„Å¶„ÅÑ„ÇãÔºü", c:["ÂÖ®ÈÉ®","ÂçäÂàÜ","„Åª„Å®„Çì„Å©Âøò„Çå„Çã"], a:2},
            {q:"„Ç¶„Çµ„ÇÆ„ÅÆËÄ≥„ÅåÈï∑„ÅÑÊúÄÂ§ß„ÅÆÁêÜÁî±„ÅØÔºü", c:["ÈõÜÈü≥","ÊîæÁÜ±","ÂèØÊÑõ„ÅÑ„Åã„Çâ"], a:1},
            {q:"Êó•Êú¨„Åß‰∏ÄÁï™È´ò„ÅÑÂ±±„ÅØ„Å©„ÇåÔºü", c:["ÂØåÂ£´Â±±","ÂåóÂ≤≥","ÈòøËòáÂ±±"], a:0},
            {q:"Ëöä„ÅÆ‰∏ªÈ£ü„ÅØÊú¨Êù•‰ΩïÔºü", c:["Ë°Ä","Ëä±„ÅÆËúú","Ê∞¥"], a:1},
            {q:"„Ç´„Éê„ÅÆÊ±ó„ÅÆËâ≤„ÅØ‰ΩïËâ≤„Å´Ë¶ã„Åà„ÇãÔºü", c:["ÈÄèÊòé","Èùí","„Éî„É≥„ÇØ"], a:2},
            {q:"‰∏ñÁïå‰∏ÄË∂≥„ÅåÈÄü„ÅÑÈô∏‰∏äÂãïÁâ©„ÅØÔºü", c:["„É©„Ç§„Ç™„É≥","„ÉÅ„Éº„Çø„Éº","„Ç¨„Çº„É´"], a:1},
            {q:"„Éà„Ç¶„É¢„É≠„Ç≥„Ç∑„ÅÆ„Å≤„Åí„ÅÆÊï∞„ÅØ‰Ωï„Å®Âêå„ÅòÔºü", c:["Ëëâ„ÅÆÊï∞","Ê†π„ÅÆÊï∞","Á≤í„ÅÆÊï∞"], a:2},
            {q:"„É™„É≥„Ç¥„ÇíÊ∞¥„Å´ÊµÆ„Åã„Åπ„Çã„Å®„Å©„ÅÜ„Å™„ÇãÔºü", c:["Ê≤à„ÇÄ","ÊµÆ„Åè","ÂõûËª¢„Åô„Çã"], a:1}
        ],
        mid: [
            {q:"„ÉÄ„Ç§„É§„É¢„É≥„Éâ„ÅÆÊàêÂàÜ„ÅØ„ÄÅÂÆü„ÅØ‰Ωï„Å®Âêå„ÅòÔºü", c:["ÈâÑ","ÁÇ≠Á¥†","Áü≥ÁÅ∞"], a:1},
            {q:"ÂÆáÂÆôÁ©∫Èñì„ÅßÊ≥£„Åè„Å®„ÄÅÊ∂ô„ÅØ„Å©„ÅÜ„Å™„ÇãÔºü", c:["ËêΩ„Å°„Çã","Ëí∏Áô∫","ÁõÆ„Å´Áïô„Åæ„Çã"], a:2},
            {q:"Êó•Êú¨„ÅÆ1ÂÜÜÁéâ„ÅÆÁõ¥ÂæÑ„ÅØ‰ΩïcmÔºü", c:["1cm","2cm","3cm"], a:1},
            {q:"ÁÅ´Êòü„ÅåËµ§„ÅèË¶ã„Åà„ÇãÁêÜÁî±„ÅØÔºü", c:["ÁÅ´„ÅåÂ§ö„ÅÑ","ÈåÜ„Å≥„ÅüÈâÑ","Êöë„ÅÑ"], a:1},
            {q:"Âú∞ÁêÉ„ÅÆËá™Ëª¢„ÄÅ1ÊôÇÈñì„ÅØ‰ΩïÂ∫¶Ôºü", c:["10Â∫¶","15Â∫¶","24Â∫¶"], a:1},
            {q:"‰∏ñÁïå‰∏ÄÈù¢Á©ç„ÅåÂ∫É„ÅÑÂõΩ„ÅØ„Å©„ÅìÔºü", c:["„Ç´„Éä„ÉÄ","„Ç¢„É°„É™„Ç´","„É≠„Ç∑„Ç¢"], a:2},
            {q:"„Éû„ÉÅ„É•„Éî„ÉÅ„É•ÈÅ∫Ë∑°„Åå„ÅÇ„ÇãÂõΩ„ÅØ„Å©„ÅìÔºü", c:["„Éö„É´„Éº","„ÉÅ„É™","„É°„Ç≠„Ç∑„Ç≥"], a:0},
            {q:"‰∫∫‰Ωì„Åß‰∏ÄÁï™Á°¨„ÅÑÈÉ®ÂàÜ„ÅØ„Å©„ÅìÔºü", c:["È†≠„ÅÆÈ™®","Ê≠Ø„ÅÆ„Ç®„Éä„É°„É´Ë≥™","Â§™„ÇÇ„ÇÇ"], a:1},
            {q:"Èõ≤„ÅØ‰Ωï„Åß„Åß„Åç„Å¶„ÅÑ„ÇãÔºü", c:["ÁÖô","Ê∞¥„ÇÑÊ∞∑„ÅÆÁ≤í","Á©∫Ê∞ó"], a:1},
            {q:"„Éï„É©„É≥„Çπ„ÅÆÈ¶ñÈÉΩ„ÅØ„Å©„ÅìÔºü", c:["„Éô„É´„É™„É≥","„É≠„É≥„Éâ„É≥","„Éë„É™"], a:2},
            {q:"Êúà„Åæ„ÅßÂÖâ„ÅåÂ±ä„ÅèÊôÇÈñì„ÅØÁ¥Ñ‰ΩïÁßíÔºü", c:["1.3Áßí","8Áßí","60Áßí"], a:0},
            {q:"È™®„ÅÆÊï∞„ÅØ„ÄÅËµ§„Å°„ÇÉ„Çì„ÅÆÊñπ„ÅåÂ§ß‰∫∫„Çà„ÇäÂ§ö„ÅÑÔºü", c:["Êú¨ÂΩì","Âòò","Âêå„Åò"], a:0},
            {q:"‰∏ñÁïå„Åß‰∏ÄÁï™Èï∑„ÅÑÂ∑ù„ÅØ„Å©„ÇåÔºü", c:["„Ç¢„Éû„Çæ„É≥","„Éä„Ç§„É´","„Éü„Ç∑„Ç∑„ÉÉ„Éî"], a:1},
            {q:"ÈáëÔºà„Ç¥„Éº„É´„ÉâÔºâ„ÅØÈåÜ„Å≥„ÇãÔºü", c:["ÈåÜ„Å≥„Çã","ÈåÜ„Å≥„Å™„ÅÑ","Êù°‰ª∂„Å´„Çà„Çã"], a:1},
            {q:"„Ç™„É™„É≥„Éî„ÉÉ„ÇØ‰∫îËº™„ÅÆÂ∑¶Á´Ø„ÅÆËâ≤„ÅØÔºü", c:["Èùí","ÈªÑËâ≤","Ëµ§"], a:0},
            {q:"Êó•Êú¨„Åß‰∏ÄÁï™Â∫É„ÅÑÊπñ„ÅØ„Å©„ÇåÔºü", c:["Èúû„É∂Êµ¶","ÁêµÁê∂Êπñ","„Çµ„É≠„ÉûÊπñ"], a:1},
            {q:"Â§™ÈôΩ„ÅÆË°®Èù¢Ê∏©Â∫¶„ÅØÁ¥Ñ‰ΩïÂ∫¶Ôºü", c:["1000Â∫¶","6000Â∫¶","100‰∏áÂ∫¶"], a:1},
            {q:"„Éî„Ç¢„Éé„ÅÆÈçµÁõ§„ÅÆÊï∞„ÅØÂÖ®ÈÉ®„Åß„ÅÑ„Åè„Å§Ôºü", c:["80","88","92"], a:1},
            {q:"Ëôπ„ÅÆËâ≤„ÄÅ‰∏ÄÁï™Â§ñÂÅ¥Ôºà‰∏äÔºâ„ÅØ‰ΩïËâ≤Ôºü", c:["Á¥´","Ëµ§","ÈªÑËâ≤"], a:1},
            {q:"Èõ∑„ÅÆÈü≥„ÅÆÈÄü„Åï„ÅØ1ÁßíÈñì„Å´Á¥Ñ‰ΩïmÔºü", c:["340m","30‰∏ákm","1km"], a:0},
            {q:"Êó•Êú¨ÊúÄÂçóÁ´Ø„ÅÆÂ≥∂„ÅØ„Å©„ÇåÔºü", c:["Ê≤ñ„ÉéÈ≥•Â≥∂","‰∏éÈÇ£ÂõΩÂ≥∂","Á´πÂØåÂ≥∂"], a:0},
            {q:"„Ç®„ÉÉ„Éï„Çß„É´Â°î„Åå„ÅÇ„ÇãÈÉΩÂ∏Ç„ÅØ„Å©„ÅìÔºü", c:["„É≠„Éº„Éû","„Éë„É™","„Éû„Éâ„É™„Éº„Éâ"], a:1},
            {q:"„Éà„É©„É≥„Éó„ÅÆÂêàË®à(JÊäú„Åç)„ÇíË∂≥„Åô„Å®Ôºü", c:["364","365","366"], a:1},
            {q:"‰∫∫Èñì„ÅÆÂøÉËáì„ÅØ1Êó•„Å´Á¥Ñ‰ΩïÂõûÊâì„Å§Ôºü", c:["1‰∏áÂõû","5‰∏áÂõû","10‰∏áÂõû"], a:2},
            {q:"Êó•Êú¨„ÅÆ1ÂÜÜÁéâ„ÅØ„ÄÅ„Ç¢„É´„Éü100ÔºÖÔºü", c:["Êú¨ÂΩì","Âòò","Êù°‰ª∂„Å´„Çà„Çã"], a:0},
            {q:"Á©∫Ê∞ó‰∏≠„Å´‰∏ÄÁï™Â§ö„ÅÑÊ∞ó‰Ωì„ÅØ„Å©„ÇåÔºü", c:["ÈÖ∏Á¥†","‰∫åÈÖ∏ÂåñÁÇ≠Á¥†","Á™íÁ¥†"], a:2},
            {q:"„Éè„ÉÅ„Éü„ÉÑ„ÅØËÖê„Çâ„Å™„ÅÑÔºü", c:["Êú¨ÂΩì","Âòò","ÂçäÂπ¥„ÅßËÖê„Çã"], a:0},
            {q:"ÂçóÊ•µ„Å®ÂåóÊ•µ„ÄÅ„Å©„Å£„Å°„ÅÆÊñπ„ÅåÂØí„ÅÑÔºü", c:["ÂçóÊ•µ","ÂåóÊ•µ","Âêå„Åò"], a:0},
            {q:"Ëá™Áî±„ÅÆÂ•≥Á•û„ÅåÂ∑¶Êâã„Å´ÊåÅ„Å£„Å¶„ÅÑ„Çã„ÅÆ„ÅØÔºü", c:["ËÅñÊõ∏","Áã¨Á´ãÂÆ£Ë®ÄÊõ∏","ÊÜ≤Ê≥ï"], a:1},
            {q:"„Ç¢„Ç§„É≥„Ç∑„É•„Çø„Ç§„É≥„ÅåÂèóË≥û„Åó„ÅüË≥û„ÅØÔºü", c:["Áâ©ÁêÜÂ≠¶Ë≥û","ÂåñÂ≠¶Ë≥û","Âπ≥ÂíåË≥û"], a:0},
            {q:"Ë°ÄÊ∂≤Âûã„ÄÅ‰∏ñÁïå„Åß‰∏ÄÁï™Â§ö„ÅÑ„ÅÆ„ÅØÔºü", c:["AÂûã","BÂûã","OÂûã"], a:2},
            {q:"„Éë„É≥„ÅØËã±Ë™ûÔºü", c:["„ÅØ„ÅÑ","„ÅÑ„ÅÑ„Åà","ÂÆü„ÅØ„Éù„É´„Éà„Ç¨„É´Ë™û"], a:1},
            {q:"Êó•Êú¨„ÅÆ5ÂÜÜÁéâ„Å´Á©¥„Åå„ÅÇ„ÇãÁêÜÁî±„ÅØÔºü", c:["ÁØÄÁ¥Ñ","Á¥ê„ÇíÈÄö„Åô","ÂÅΩÈÄ†Èò≤Ê≠¢"], a:0},
            {q:"1„Éû„Ç§„É´„ÅØÁ¥Ñ‰Ωï„Ç≠„É≠„É°„Éº„Éà„É´Ôºü", c:["1km","1.6km","2km"], a:1}
        ],
        boss: [
            {q:"ÂÖâ„ÅØ1ÁßíÈñì„Å´Âú∞ÁêÉ„ÇíÁ¥Ñ‰ΩïÂë®„Åô„ÇãÔºü", c:["3Âë®","7Âë®Âçä","10Âë®"], a:1},
            {q:"Â∞ÜÊ£ã„Åß„ÄÅË£èËøî„Å£„Å¶„ÇÇÂêçÂâç„ÅåÂ§â„Çè„Çâ„Å™„ÅÑ„ÅÆ„ÅØÔºü", c:["È£õËªä","ËßíË°å","ÁéãÂ∞Ü"], a:2},
            {q:"ÂéüÂ≠êÁï™Âè∑1Áï™„ÅÆÂÖÉÁ¥†„ÅØ‰ΩïÔºü", c:["„Éò„É™„Ç¶„É†","Ê∞¥Á¥†","„É™„ÉÅ„Ç¶„É†"], a:1},
            {q:"„Éû„É™„Ç¢„ÉäÊµ∑Ê∫ù„ÅÆÊ∑±„Åï„ÅØÁ¥Ñ‰ΩïmÔºü", c:["5000m","8000m","1‰∏ám‰ª•‰∏ä"], a:2},
            {q:"„Éã„É•„Éº„Éà„É≥„ÅåÂºïÂäõ„Å´Ê∞ó„Å•„ÅÑ„ÅüÊûúÁâ©„ÅØÔºü", c:["Ê°É","„Ç™„É¨„É≥„Ç∏","„É™„É≥„Ç¥"], a:2},
            {q:"Êó•Êú¨„ÅÆÂàù‰ª£ÂÜÖÈñ£Á∑èÁêÜÂ§ßËá£„ÅØÔºü", c:["‰ºäËó§ÂçöÊñá","Á¶èÊ≤¢Ë´≠Âêâ","ÁπîÁî∞‰ø°Èï∑"], a:0},
            {q:"„É¢„Éä„Éª„É™„Ç∂„ÇíÊèè„ÅÑ„Åü„ÅÆ„ÅØË™∞Ôºü", c:["„Éî„Ç´„ÇΩ","„ÉÄ„Éª„É¥„Ç£„É≥„ÉÅ","„Ç¥„ÉÉ„Éõ"], a:1},
            {q:"1ÂÖÜ„ÅÆ1000ÂÄç„Çí‰Ωï„Å®Âëº„Å∂Ôºü", c:["Âûì","‰∫¨","Á©£"], a:1},
            {q:"„Éä„Éù„É¨„Ç™„É≥„ÅåÊúÄÂæå„Å´ÊµÅ„Åï„Çå„ÅüÂ≥∂„ÅØÔºü", c:["„Ç®„É´„Éê","„Çª„É≥„Éà„Éò„É¨„Éä","„Ç≥„É´„Ç∑„Ç´"], a:1},
            {q:"Â§™ÈôΩÁ≥ª„Åß‰∏ÄÁï™Â§ß„Åç„ÅÑÊÉëÊòü„ÅØÔºü", c:["ÂúüÊòü","Â§©ÁéãÊòü","Êú®Êòü"], a:2},
            {q:"„Éî„É©„Éü„ÉÉ„Éâ„Åå‰Ωú„Çâ„Çå„Åü‰∏ª„Å™ÁõÆÁöÑ„ÅØÔºü", c:["Â§©ÊñáÂè∞","„ÅäÂ¢ì","Á©ÄÁâ©Â∫´"], a:1},
            {q:"Á¨¨‰πù„ÇíÊõ∏„ÅÑ„Åü‰ΩúÊõ≤ÂÆ∂„ÅØË™∞Ôºü", c:["„Éô„Éº„Éà„Éº„É¥„Çß„É≥","„É¢„Éº„ÉÑ„Ç°„É´„Éà","„Éê„ÉÉ„Éè"], a:0},
            {q:"Êúà„ÅÆÂë®Êúü„ÅØÁ¥Ñ‰ΩïÊó•Ôºü", c:["28Êó•","29.5Êó•","31Êó•"], a:1},
            {q:"ÂçóÊ•µ„Å´„ÅÇ„ÇãÊó•Êú¨„ÅÆË¶≥Ê∏¨Âü∫Âú∞„Å®„ÅÑ„Åà„Å∞Ôºü", c:["Êò≠ÂíåÂü∫Âú∞","Âπ≥ÊàêÂü∫Âú∞","Â§ßÂíåÂü∫Âú∞"], a:0},
            {q:"„Éè„ÉØ„Ç§„ÅØ„Ç¢„É°„É™„Ç´„ÅÆ‰ΩïÁï™ÁõÆ„ÅÆÂ∑ûÔºü", c:["48","49","50"], a:2},
            {q:"„Ç™„Éº„É≠„É©„ÅåÁô∫Áîü„Åô„Çã„ÅÆ„ÅØ„Å©„ÅÆÂ±§Ôºü", c:["ÂØæÊµÅÂúè","ÊàêÂ±§Âúè","ÁÜ±Âúè"], a:2},
            {q:"‰∫∫Èñì„ÅÆDNA„ÄÅ„ÉÅ„É≥„Éë„É≥„Ç∏„Éº„Å®‰ΩïÔºÖÂêå„ÅòÔºü", c:["80ÔºÖ","90ÔºÖ","98ÔºÖ‰ª•‰∏ä"], a:2},
            {q:"ÂÆáÂÆô„ÅÆÂßã„Åæ„Çä„Å®„Åï„Çå„ÇãÁàÜÁô∫„ÅØÔºü", c:["„Éì„ÉÉ„Ç∞„Éê„É≥","„Éé„É¥„Ç°","„Éñ„É©„ÉÉ„ÇØ„Éõ„Éº„É´"], a:0},
            {q:"Èù¢Á©ç„Åå‰∏ñÁïå‰∏ÄÂ∞è„Åï„ÅÑÂõΩ„ÅØÔºü", c:["„É¢„Éä„Ç≥","„Éê„ÉÅ„Ç´„É≥","„Éä„Ç¶„É´"], a:1},
            {q:"„Éé„Éº„Éô„É´„ÅåÁô∫Êòé„Åó„Åü„ÅÆ„ÅØÔºü", c:["ÈõªÁêÉ","ÈõªË©±","„ÉÄ„Ç§„Éä„Éû„Ç§„Éà"], a:2},
            {q:"Âúü‰øµ„ÅÆÁõ¥ÂæÑ„ÅØ‰Ωï„É°„Éº„Éà„É´Ôºü", c:["4m24cm","4m55cm","5m"], a:1},
            {q:"„Éñ„É´„Ç∏„É•„Éª„Éè„É™„Éï„Ç°„Åå„ÅÇ„ÇãÈÉΩÂ∏Ç„ÅØÔºü", c:["„Éâ„Éê„Ç§","‰∏äÊµ∑","„Éã„É•„Éº„É®„Éº„ÇØ"], a:0},
            {q:"ÂÖâ„Åå1Âπ¥Èñì„Å´ÈÄ≤„ÇÄË∑ùÈõ¢„Çí‰Ωï„Å®„ÅÑ„ÅÜÔºü", c:["1„Éû„Ç§„É´","1ÂÖâÂπ¥","1„Éë„Éº„Çª„ÇØ"], a:1},
            {q:"„Ç§„Çø„É™„Ç¢„ÅÆÈÄöË≤®„ÄÅ„É¶„Éº„É≠„ÅÆÂâç„ÅØÔºü", c:["„Éï„É©„É≥","„É™„É©","„Éû„É´„ÇØ"], a:1},
            {q:"„Ç¢„Éù„É≠11Âè∑„ÅåÊúàÈù¢ÁùÄÈô∏„Å´ÊàêÂäü„Åó„Åü„ÅÆ„ÅØÔºü", c:["1964","1969","1972"], a:1},
            {q:"Â∞ÜÊ£ãÁõ§„ÅÆ„Éû„ÇπÁõÆ„ÅØÂÖ®ÈÉ®„Åß„ÅÑ„Åè„Å§Ôºü", c:["64","81","100"], a:1},
            {q:"Êù±‰∫¨„Çø„ÉØ„Éº„ÅÆÈ´ò„Åï„ÅØ‰Ωï„É°„Éº„Éà„É´Ôºü", c:["300m","333m","634m"], a:1},
            {q:"‰∏ñÁïå‰∏ÄÈï∑„ÅÑ„Å®„Åï„Çå„ÇãÂ∞èË™¨„ÅØ„Å©„ÇåÔºü", c:["Êà¶‰∫â„Å®Âπ≥Âíå","Â§±„Çè„Çå„ÅüÊôÇ„ÇíÊ±Ç„ÇÅ„Å¶","Ê∫êÊ∞è"], a:1},
            {q:"ÈáéÁêÉ„ÅÆ„ÉÄ„Ç§„É§„É¢„É≥„Éâ1Ëæ∫„ÅØÁ¥Ñ‰ΩïmÔºü", c:["25m","27.4m","30m"], a:1},
            {q:"Âú∞ÁêÉ„Åã„Çâ‰∏ÄÁï™Ëøë„ÅÑÊÅíÊòü(Â§™ÈôΩ‰ª•Â§ñ)„ÅØÔºü", c:["„Ç∑„É™„Ç¶„Çπ","„Éó„É≠„Ç≠„Ç∑„Éû","„Éô„Ç¨"], a:1},
            {q:"Êó•Êú¨Âàù„ÅÆÈâÑÈÅì„ÅåËµ∞„Å£„Åü„ÅÆ„ÅØ„Å©„ÅìÈñìÔºü", c:["Êñ∞Ê©ãÔΩûÊ®™Êµú","‰∏äÈáéÔΩûÊµÖËçâ","Êù±‰∫¨ÔΩûÂ§ßÈò™"], a:0},
            {q:"‰∏ÄÂÜÜÁéâ„ÅØ‰Ωï„Ç∞„É©„É†Ôºü", c:["1g","2g","5g"], a:0}
        ]
    };

    let currentQuizPool = JSON.parse(JSON.stringify(masterQuizData));
    let hp = 100, eHp = 100, score = 0, mochi = 3, streak = 0, defCount = 0, timerId = null;

    function startGame() {
        Object.values(sounds).forEach(s => { try{ s.play(); s.pause(); s.currentTime=0; }catch(e){} });
        sounds.vPromo.volume = 1.0; sounds.tick.volume = 1.0; sounds.comboSE.volume = 1.0; sounds.bgm.volume = 0.1; sounds.bgm.loop = true;
        document.getElementById('start-screen').style.display = 'none';
        sounds.bgm.play().catch(e => {});
        updateUI(); loadQuiz();
    }

    function loadQuiz() {
        if(hp <= 0) return;
        let type = (defCount >= 10) ? "boss" : (defCount >= 4) ? "mid" : "weak";
        let pool = currentQuizPool[type];
        if (pool.length === 0) pool = JSON.parse(JSON.stringify(masterQuizData[type]));
        let qIdx = Math.floor(Math.random() * pool.length);
        let q = pool.splice(qIdx, 1)[0];
        
        document.getElementById('enemy-thumb').src = "images/enemy_" + type + ".png";
        document.getElementById('main-illust').src = "images/gemini_zunda_think.png";
        document.getElementById('question-box').innerText = q.q;
        const container = document.getElementById('choices');
        container.innerHTML = "";
        q.c.forEach((choice, i) => {
            const btn = document.createElement('button');
            btn.className = "choice-btn"; btn.innerText = choice;
            btn.onclick = () => {
                clearInterval(timerId);
                if(i === q.a) {
                    streak++; score += (100 + (streak > 1 ? streak * 25 : 0));
                    
                    // ‚òÖ„ÉÄ„É°„Éº„Ç∏„Çí25„Å´Ë™øÊï¥ÔºÅ„Åì„Çå„Åß100‚Üí75‚Üí50‚Üí25‚Üí0„Å®„Å™„Çã„ÅÆ„Å†
                    eHp -= 25; 

                    if (eHp > 0) {
                        sounds.ok.play().catch(e=>{});
                        setTimeout(() => {
                            if (streak > 1) { sounds.comboSE.currentTime = 0; sounds.comboSE.play().catch(e=>{}); }
                            let voice = sounds["vCombo" + Math.min(streak, 4)];
                            if (voice) { voice.currentTime = 0; voice.play().catch(e=>{}); }
                        }, 400);
                        if(streak > 1) showCombo();
                    }
                    document.getElementById('main-illust').src = "images/gemini_attack_weak.png";
                } else {
                    streak = 0; hp -= 20; 
                    sounds.ng.play().catch(e=>{});
                    document.getElementById('main-illust').src = "images/gemini_damage_weak_comic.png";
                    document.getElementById('game-container').classList.add('shake');
                    setTimeout(() => document.getElementById('game-container').classList.remove('shake'), 500);
                }
                updateUI(); checkBattle();
            };
            container.appendChild(btn);
        });
        startTimer();
    }

    function startTimer() {
        clearInterval(timerId);
        let time = 100, lastTick = 100;
        timerId = setInterval(() => {
            time -= 0.9; document.getElementById('timer-bar').style.width = time + "%";
            if (Math.floor(time) < lastTick) { try{ sounds.tick.currentTime=0; sounds.tick.play(); }catch(e){} lastTick = Math.floor(time); }
            if(time <= 0) { clearInterval(timerId); streak = 0; hp -= 20; updateUI(); loadQuiz(); }
        }, 100);
    }

    function updateUI() {
        // „Éó„É¨„Ç§„É§„ÉºHP
        const pFill = document.getElementById('player-hp-fill');
        pFill.style.width = hp + "%";
        if (hp > 60) pFill.style.backgroundColor = "#7dc065";
        else if (hp > 30) pFill.style.backgroundColor = "#ffda44";
        else pFill.style.backgroundColor = "#f47b7b";

        // ÊïµHP
        const eFill = document.getElementById('enemy-hp-fill');
        const dEhp = Math.max(0, eHp);
        eFill.style.width = dEhp + "%";
        // ‚òÖ„Åì„Åì„ÇíÂé≥ÂØÜ„Å´„ÄÇ25%„Å´„Å™„Çå„Å∞Á¢∫ÂÆü„Å´Ëµ§Ëâ≤„Å™„ÅÆ„Å†ÔºÅ
        if (dEhp > 60) eFill.style.backgroundColor = "#7dc065";
        else if (dEhp > 30) eFill.style.backgroundColor = "#ffda44";
        else eFill.style.backgroundColor = "#f47b7b";

        document.getElementById('score-val').innerText = score;
        document.getElementById('mochi-val').innerText = mochi;
    }

    function checkBattle() {
        if(hp <= 0) { setTimeout(endGame, 1000); }
        else if(eHp <= 0) { 
            sounds.defeat.play().catch(e=>{});
            let hb = hp * 10, mb = mochi * 200, tb = 500 + hb + mb;
            score += tb; defCount++; eHp = 100; 
            alert("ÊíÉÁ†¥ÔºÅ\nHP„Éú„Éº„Éä„Çπ: " + hb + "\n„ÇÇ„Å°„Éú„Éº„Éä„Çπ: " + mb + "\nË®à " + tb + "ÁÇπÁç≤ÂæóÔºÅ"); 
            updateUI(); loadQuiz(); 
        } else { setTimeout(loadQuiz, 1300); }
    }

    function useItem() { if(mochi > 0 && hp < 100) { mochi--; hp = Math.min(hp + 50, 100); sounds.heal.play().catch(e=>{}); updateUI(); } }
    function showCombo() { const p = document.getElementById('combo-pop'); p.innerText = streak + " COMBO!"; p.style.opacity = "1"; setTimeout(() => p.style.opacity = "0", 800); }

    function endGame() {
        sounds.bgm.pause(); sounds.result.play().catch(e=>{});
        document.getElementById('final-score').innerText = score;
        let ranks = JSON.parse(localStorage.getItem('zunda_rankings')) || [];
        if (ranks.length < 3 || score > (ranks[ranks.length-1]?.score || 0)) {
            let n = prompt("„É©„É≥„ÇØ„Ç§„É≥ÔºÅ„ÅäÂêçÂâç„ÅØÔºü", "„Åö„Çì„Å†ÂêçÁÑ°„Åó");
            if (n) { ranks.push({name: n, score: score}); ranks.sort((a,b) => b.score - a.score); ranks = ranks.slice(0, 3); localStorage.setItem('zunda_rankings', JSON.stringify(ranks)); }
        }
        document.getElementById('rank-body').innerHTML = ranks.map((r,i) => "<tr><td>"+(i+1)+"</td><td>"+r.name+"</td><td>"+r.score+"</td></tr>").join('');
        document.getElementById('result-screen').style.display = 'flex';
        setTimeout(() => { try{ sounds.vPromo.play(); }catch(e){} }, 2500);
    }

    document.getElementById('btn-start').onclick = startGame;
    document.getElementById('btn-item').onclick = useItem;
</script>
</body>
</html>
