<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ãšã‚“ã è±†çŸ¥è­˜RPG - ç™¾å•è€ä¹…ãƒ»è¦šé†’ç·¨</title>
    <style>
        body { background-color: #f0f0f0; margin: 0; display: flex; justify-content: center; height: 100vh; overflow: hidden; font-family: sans-serif; }
        
        #game-container { 
            width: 100%; max-width: 480px; height: 100vh; background: #fff; 
            border: 8px solid #7dc065; box-sizing: border-box; 
            display: flex; flex-direction: column; position: relative; overflow: hidden;
        }
        
        /* ãƒãƒˆãƒ«ã‚¨ãƒªã‚¢ï¼šPCã§ã‚‚ã¯ã¿å‡ºã•ãªã„ã‚ˆã†é«˜ã•ã‚’èª¿æ•´ */
        #top-battle-area { 
            background-color: #bce6f9; height: 45%; min-height: 280px;
            padding: 10px 15px; display: flex; flex-direction: column; 
            align-items: center; position: relative; gap: 5px; overflow: hidden; 
        }
        
        #combo-aura { position: absolute; top:0; left:0; width:100%; height:100%; pointer-events: none; opacity: 0; transition: 0.5s; background: radial-gradient(circle, rgba(255,165,0,0.5) 0%, rgba(255,69,0,0) 70%); z-index: 1; }

        .status-pill { background: #fff; border: 3px solid #000; border-radius: 40px; padding: 4px 12px; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 0 rgba(0,0,0,0.1); width: 85%; max-width: 350px; z-index: 10; }
        .hp-bg { flex: 1; height: 12px; background: #eee; border-radius: 6px; border: 2px solid #999; overflow: hidden; }
        .hp-fill { height: 100%; width: 100%; transition: width 0.3s, background-color 0.3s; background: #7dc065; }

        #main-action-view { flex: 1; display: flex; justify-content: center; align-items: center; width: 100%; z-index: 5; overflow: hidden; }
        #main-illust { max-width: 100%; max-height: 160px; object-fit: contain; border: 3px solid #333; background: #fff; border-radius: 10px; }
        
        #combo-pop { position: absolute; top: 15%; left: 50%; transform: translateX(-50%); color: #ff9800; font-size: 36px; font-weight: bold; text-shadow: 2px 2px 0 #fff; opacity: 0; z-index: 100; pointer-events: none; }
        .max-combo-active { color: #ff3d00 !important; font-size: 50px !important; animation: pulse-anim 0.5s infinite alternate; }

        /* UIã‚¨ãƒªã‚¢ï¼šã“ã“ãŒæŠ¼ã—å‡ºã•ã‚Œãªã„ã‚ˆã†ã«é«˜ã•ã‚’ç¢ºä¿ */
        #bottom-ui-area { 
            flex: 1; background: #fff; border-top: 6px solid #7dc065; 
            padding: 10px 15px; z-index: 20; display: flex; flex-direction: column;
        }
        
        #timer-bg { width: 100%; height: 14px; background: #eee; border: 2px solid #333; border-radius: 7px; overflow: hidden; margin-bottom: 8px; }
        #timer-bar { height: 100%; width: 100%; background: #f47b7b; }
        
        #question-box { 
            background: #333; color: #fff; border-radius: 12px; padding: 10px; 
            text-align: center; font-size: 15px; font-weight: bold; 
            min-height: 60px; display: flex; align-items: center; justify-content: center; 
            margin-bottom: 10px; line-height: 1.4;
        }
        
        .choice-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; flex: 1; }
        .choice-btn { background: #fff; border: 3px solid #7dc065; border-radius: 10px; padding: 8px 4px; font-weight: bold; font-size: 13px; cursor: pointer; box-shadow: 0 3px 0 #5a9e43; display: flex; align-items: center; justify-content: center; }
        
        .full-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.98); z-index:2000; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; padding:20px; box-sizing:border-box; }
        .big-btn { padding: 15px 40px; font-size: 20px; font-weight: bold; background: #7dc065; color: white; border: none; border-radius: 40px; cursor: pointer; box-shadow: 0 6px 0 #5a9e43; }

        #bonus-pop-up { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); color: #ff3d00; font-size: 28px; font-weight: bold; text-shadow: 2px 2px 0 #fff; background: rgba(255,255,255,0.95); padding: 10px; border-radius: 15px; border: 4px solid #ff9800; display: none; z-index: 500; text-align: center; }

        /* å®£ä¼ãƒœãƒƒã‚¯ã‚¹ã®æ–°ã—ã„ãƒ‡ã‚¶ã‚¤ãƒ³ */
        #promo-box {
            border: 4px solid #f47b7b;
            border-radius: 20px;
            padding: 15px;
            background: linear-gradient(to bottom, #fff, #ffebeb);
            margin: 15px 0;
            width: 90%;
            box-shadow: 0 8px 16px rgba(244, 123, 123, 0.3);
            text-decoration: none;
            display: block;
            color: inherit;
            transition: transform 0.2s;
        }
        #promo-box:active { transform: scale(0.98); }
        .promo-title {
            color: #d32f2f;
            font-weight: 900;
            margin: 0 0 10px 0;
            font-size: 18px;
            text-shadow: 1px 1px 0 #fff, 2px 2px 0 rgba(211, 47, 47, 0.2);
        }
        .promo-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .promo-img {
            width: 100px;
            border-radius: 12px;
            border: 3px solid #f47b7b;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .promo-btn {
            background: linear-gradient(to bottom, #7dc065, #5a9e43);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 4px 0 #3e7a2e;
            text-shadow: 1px 1px 0 #3e7a2e;
            display: inline-block;
        }

        @keyframes pulse-anim { from { transform: translateX(-50%) scale(1); } to { transform: translateX(-50%) scale(1.1); } }
        .shake-screen { animation: shake 0.3s; }
        @keyframes shake { 0%,100%{transform:translate(0,0)} 25%{transform:translate(4px,4px)} 75%{transform:translate(-4px,-4px)} }
    </style>
</head>
<body>

<div id="game-container">
    <div id="bonus-pop-up">MAX COMBO BONUS!</div>

    <div id="start-screen" class="full-overlay">
        <img src="images/game_title.png" style="width:80%; margin-bottom:20px; border:4px solid #7dc065; border-radius:15px;">
        <button id="btn-start-game" class="big-btn">å†’é™ºé–‹å§‹ãªã®ã ï¼</button>
        <p id="loading-msg" style="font-size:14px; color:#7dc065; font-weight:bold; margin-top:15px;">ãƒ—ãƒ­ã‚°ãƒ©ãƒ èª­ã¿è¾¼ã¿ä¸­...</p>
        <div id="err-log" style="color:red; font-size:10px; display:none;"></div>
    </div>

    <div id="result-screen" class="full-overlay" style="display:none;">
        <h2 style="margin:0;">çµæœç™ºè¡¨ãªã®ã ï¼</h2>
        <div style="font-size:40px; font-weight:bold; color:#ff9800; margin:5px 0;"><span id="final-score">0</span>ç‚¹</div>
        
        <a href="https://line.me/S/sticker/32533905" target="_blank" id="promo-box">
            <p class="promo-title">ï¼¼ ã‚‚ã£ã¨ãšã‚“ã ã‚‚ã‚“ã—ã‚ƒã¹ã‚‹ã®ã ï¼ ï¼</p>
            <div class="promo-content">
                <img src="images/IMG_0294.PNG" class="promo-img">
                <div>
                    <div class="promo-btn">ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¦‹ã‚‹ã®ã ï¼</div>
                </div>
            </div>
        </a>

        <table class="rank-table" style="width:100%; border-collapse:collapse;"><tbody id="rank-body"></tbody></table>
        <button class="big-btn" onclick="location.reload()" style="background:#ffda44; color:#333; margin-top:15px;">ã‚‚ã†ä¸€åº¦éŠã¶</button>
    </div>

    <div id="all-clear-screen" class="full-overlay" style="display:none;">
        <h2 style="margin:0; color:#7dc065; font-size:24px;">ğŸ‰100å•å®Œå…¨åˆ¶è¦‡ãªã®ã ï¼ğŸ‰</h2>
        <div style="font-size:32px; font-weight:bold; color:#ff9800; margin:5px 0;"><span id="clear-score">0</span>ç‚¹</div>
        <a href="#" style="display:block; margin:10px 0; border:4px solid #ffda44; border-radius:15px; overflow:hidden; width:90%;">
            <p style="background:#ffda44; margin:0; padding:5px; font-weight:bold; color:#333; font-size:12px;">â–¼ æ¬¡ã®å†’é™ºã‚’é¸ã¶ã®ã ï¼ â–¼</p>
            <img src="images/next_stage_banner.png" style="width:100%; display:block;" alt="æ¬¡ã‚¹ãƒ†ãƒ¼ã‚¸">
        </a>
        <table class="rank-table" style="width:100%; border-collapse:collapse;"><tbody id="clear-rank-body"></tbody></table>
        <button class="big-btn" onclick="location.reload()" style="padding:10px 30px; font-size:16px;">æœ€åˆã‹ã‚‰éŠã¶</button>
    </div>

    <div id="top-battle-area">
        <div id="combo-aura"></div>
        <div class="status-pill" style="align-self: flex-start;">
            <img id="enemy-thumb" src="images/enemy_weak.png" style="width:30px; height:30px;">
            <div class="hp-bg"><div id="enemy-hp-fill" class="hp-fill"></div></div>
        </div>
        <div id="main-action-view">
            <div id="combo-pop">0 COMBO!</div>
            <img id="main-illust" src="images/gemini_zunda_think.png">
        </div>
        <div class="status-pill" style="align-self: flex-end;">
            <div class="hp-bg"><div id="player-hp-fill" class="hp-fill"></div></div>
            <img src="images/gemini_zunda_think.png" style="width:30px; height:30px; border-radius:50%; border:2px solid #7dc065;">
        </div>
    </div>

    <div id="bottom-ui-area">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
            <div id="btn-mochi" style="border:2px solid #7dc065; padding:2px 8px; border-radius:8px; cursor:pointer; background:#fff; font-size:12px; font-weight:bold;">ğŸ¡ x<span id="mochi-val">3</span></div>
            <div id="timer-bg" style="flex:1; margin:0 10px;"><div id="timer-bar"></div></div>
            <div style="font-weight:bold; color:#ff9800; font-size:14px;">SCORE: <span id="score-val">0</span></div>
        </div>
        <div style="text-align:right; font-size:11px; color:#7dc065; font-weight:bold; margin-bottom:2px;">æ­£è§£æ•°: <span id="correct-count">0</span>/100</div>
        <div id="question-box"></div>
        <div id="choices" class="choice-grid"></div>
    </div>
</div>

<script>
    window.onerror = function(m, u, l) {
        document.getElementById('err-log').style.display = 'block';
        document.getElementById('err-log').innerText = m + " (" + l + "è¡Œç›®)";
        document.getElementById('loading-msg').innerText = "ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿãªã®ã ...";
    };

    const sounds = {
        bgm: new Audio('sounds/bgm_thinking.mp3'),
        result: new Audio('sounds/bgm_result.mp3'),
        ok: new Audio('sounds/se_correct.mp3'),
        ng: new Audio('sounds/se_damage.mp3'),
        tick: new Audio('sounds/se_tick.mp3'),
        heal: new Audio('sounds/se_heal.mp3'),
        defeat: new Audio('sounds/se_defeat.mp3'),
        comboSE: new Audio('sounds/se_combo.mp3'),
        vCombo1: new Audio('sounds/voice_combo1.mp3'),
        vCombo2: new Audio('sounds/voice_combo2.mp3'),
        vCombo3: new Audio('sounds/voice_combo3.mp3'),
        vCombo4: new Audio('sounds/voice_combo4.mp3'),
        vPromo: new Audio('sounds/voice_promo.mp3')
    };

    // â˜…æ–‡å­—åŒ–ã‘å¯¾ç­–ç‰ˆã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿
    const masterQuizData = {
        weak: [{q:"ãƒ‘ãƒ³ãƒ€ã®å°»å°¾ã®è‰²ã¯ä½•è‰²ï¼Ÿ",c:["é»’è‰²","ç™½è‰²","ã—ã¾æ¨¡æ§˜"],a:1},{q:"ã‚¤ãƒã‚´ã®è¡¨é¢ã®ç²’ã®æ­£ä½“ã¯ï¼Ÿ",c:["ç¨®","æœå®Ÿ","èŒ"],a:1},{q:"ãƒãƒŠãƒŠã¯ä½•ã®ä»²é–“ï¼Ÿ",c:["è‰ã®ä»²é–“","æœ¨ã®ä»²é–“","ãƒ¤ã‚·ã®ä»²é–“"],a:0},{q:"ã‚¿ã‚³ã®å¿ƒè‡“ã¯ã„ãã¤ã‚ã‚‹ï¼Ÿ",c:["1ã¤","2ã¤","3ã¤"],a:2},{q:"ã‚­ãƒªãƒ³ã®è§’ã¯ä½•æœ¬ã‚ã‚‹ï¼Ÿ",c:["2æœ¬","3æœ¬","5æœ¬"],a:2},{q:"ã‚·ãƒã‚¦ãƒã®åœ°è‚Œã®è‰²ã¯ä½•è‰²ï¼Ÿ",c:["ç™½è‰²","é»’è‰²","æ¡ƒè‰²"],a:1},{q:"ã‚»ãƒŸãŒé³´ãã®ã¯ã©ã£ã¡ï¼Ÿ",c:["ã‚ªã‚¹","ãƒ¡ã‚¹","ä¸¡æ–¹"],a:0},{q:"ã‚³ã‚¢ãƒ©ã®å¹³å‡ç¡çœ æ™‚é–“ã¯ï¼Ÿ",c:["12æ™‚é–“","18æ™‚é–“","22æ™‚é–“"],a:2},{q:"ãƒ©ãƒƒã‚³ãŒæµã•ã‚Œãªã„å·¥å¤«ã¯ï¼Ÿ",c:["å²©ã‚’æ´ã‚€","æµ·è—»ã‚’ä½“ã«å·»ã","æ‰‹ã‚’ç¹‹ã"],a:1},{q:"ä¸€ç•ªé€Ÿãé£›ã¶é³¥ã¯ï¼Ÿ",c:["ãƒãƒ¤ãƒ–ã‚µ","ãƒ€ãƒãƒ§ã‚¦","ãƒ„ãƒãƒ¡"],a:0},{q:"ãƒšãƒ³ã‚®ãƒ³ã®è†ã¯ã©ã†ãªã£ã¦ã„ã‚‹ï¼Ÿ",c:["ãªã„","æ›²ãŒã£ã¦ã„ã‚‹","ç›´ç«‹ã—ã¦ã„ã‚‹"],a:1},{q:"ã‚«ãƒ©ã‚¹ã¯è‰²ã‚’è­˜åˆ¥ã§ãã‚‹ï¼Ÿ",c:["ã§ããªã„","å°‘ã—ã§ãã‚‹","äººé–“ã‚ˆã‚Šè¦‹ãˆã‚‹"],a:2},{q:"ãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼ã®æ „é¤Šæºã¯ã©ã“ï¼Ÿ",c:["èŒ","ã¤ã¼ã¿","è‘‰"],a:0},{q:"çŒ«ã®è€³ã‚’å‹•ã‹ã™ç­‹è‚‰ã¯äººã®ä½•å€ï¼Ÿ",c:["3å€","10å€","30å€"],a:2},{q:"ã‚¢ãƒªã®å¹³å‡å¯¿å‘½ã¯ã©ã‚Œãã‚‰ã„ï¼Ÿ",c:["æ•°é€±é–“","1å¹´ã‹ã‚‰2å¹´","10å¹´ä»¥ä¸Š"],a:1},{q:"ã‚«ã‚¿ãƒ„ãƒ ãƒªã®æ­¯ã®æ•°ã¯ï¼Ÿ",c:["0æœ¬","100æœ¬","1ä¸‡æœ¬ä»¥ä¸Š"],a:2},{q:"ã‚µãƒ¡ã®éª¨ã¯ä½•ã§ã§ãã¦ã„ã‚‹ï¼Ÿ",c:["æ™®é€šã®éª¨","è»Ÿéª¨","é‰„åˆ†"],a:1},{q:"ãƒ©ãƒ•ãƒ¬ã‚·ã‚¢ã®èŠ±ã®åŒ‚ã„ã¯ï¼Ÿ",c:["ç”˜ã„åŒ‚ã„","ç„¡è‡­","è…ã£ãŸè‚‰ã®åŒ‚ã„"],a:2},{q:"ãƒ’ãƒãƒ¯ãƒªãŒå¤ªé™½ã‚’è¿½ã†ã®ã¯ï¼Ÿ",c:["è‹¥ã„æ™‚ã ã‘","ãšã£ã¨è¿½ã†","è¿½ã‚ãªã„"],a:0},{q:"ãƒ¯ãƒ‹ã®æ€§åˆ¥ã‚’æ±ºã‚ã‚‹è¦å› ã¯ï¼Ÿ",c:["éºä¼","åµã®æ™‚ã®æ¸©åº¦","é‹"],a:1},{q:"ã‚«ãƒ³ã‚¬ãƒ«ãƒ¼èª•ç”Ÿæ™‚ã®ã‚µã‚¤ã‚ºã¯ï¼Ÿ",c:["ç´„2cm","ç´„10cm","ç´„30cm"],a:0},{q:"ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³ã®è‰²å¤‰ãˆç†ç”±ã¯ï¼Ÿ",c:["éš ã‚Œã‚‹ãŸã‚","æ„Ÿæƒ…ã‚„æ¸©åº¦","æ“¬æ…‹ã®ãŸã‚"],a:1},{q:"ãƒ•ã‚¯ãƒ­ã‚¦ã®é¦–ã®å›è»¢è§’åº¦ã¯ï¼Ÿ",c:["180åº¦","270åº¦","360åº¦"],a:1},{q:"ãƒ©ã‚¤ã‚ªãƒ³ã®ç‹©ã‚Šæ‹…å½“ã¯ä¸»ã«ã©ã£ã¡ï¼Ÿ",c:["ã‚ªã‚¹","ãƒ¡ã‚¹","å­ä¾›"],a:1},{q:"è±¡ã¯ã‚¸ãƒ£ãƒ³ãƒ—ã§ãã‚‹ï¼Ÿ",c:["ã§ããªã„","ã§ãã‚‹","ç¨®é¡ã«ã‚ˆã‚‹"],a:0},{q:"ãƒ›ãƒƒã‚­ãƒ§ã‚¯ã‚°ãƒã®åœ°è‚Œã¯ä½•è‰²ï¼Ÿ",c:["ç™½è‰²","æ¡ƒè‰²","é»’è‰²"],a:2},{q:"ãƒªã‚¹ã®åŸ‹ã‚ãŸå ´æ‰€ã®è¨˜æ†¶ã¯ï¼Ÿ",c:["å®Œç’§ã«è¦šãˆã¦ã„ã‚‹","åŠåˆ†å¿˜ã‚Œã‚‹","ã»ã¨ã‚“ã©å¿˜ã‚Œã‚‹"],a:2},{q:"ã‚¦ã‚µã‚®ã®è€³ãŒé•·ã„ç†ç”±ã¯ï¼Ÿ",c:["éŸ³ã‚’é›†ã‚ã‚‹ãŸã‚","ä½“æ¸©ã‚’é€ƒãŒã™ãŸã‚","å¯æ„›ã„ã‹ã‚‰"],a:1},{q:"æ—¥æœ¬ä¸€é«˜ã„å±±ã¯ã©ã‚Œï¼Ÿ",c:["å¯Œå£«å±±","åŒ—å²³","é˜¿è˜‡å±±"],a:0},{q:"èšŠã®ä¸»é£Ÿã¯æœ¬æ¥ä½•ï¼Ÿ",c:["è¡€","èŠ±ã®èœœ","æ°´"],a:1},{q:"ã‚«ãƒã®æ±—ã®è‰²ã¯ä½•è‰²ã«è¦‹ãˆã‚‹ï¼Ÿ",c:["é€æ˜","é’è‰²","æ¡ƒè‰²"],a:2},{q:"æœ€é€Ÿã®é™¸ä¸Šå‹•ç‰©ã¯ï¼Ÿ",c:["ãƒ©ã‚¤ã‚ªãƒ³","ãƒãƒ¼ã‚¿ãƒ¼","ã‚¬ã‚¼ãƒ«"],a:1},{q:"ãƒˆã‚¦ãƒ¢ãƒ­ã‚³ã‚·ã®ã²ã’ã¯ï¼Ÿ",c:["è‘‰ã®æ•°","æ ¹ã®æ•°","ç²’ã®æ•°"],a:2},{q:"ãƒªãƒ³ã‚´ã‚’æ°´ã«å…¥ã‚Œã‚‹ã¨ã©ã†ãªã‚‹ï¼Ÿ",c:["æ²ˆã‚€","æµ®ã","å›è»¢ã™ã‚‹"],a:1}],
        mid: [{q:"ãƒ€ã‚¤ãƒ¤ã®æ­£ä½“ã¯ä½•ã¨åŒã˜æˆåˆ†ï¼Ÿ",c:["é‰„","ç‚­ç´ ","çŸ³ç°"],a:1},{q:"å®‡å®™ã§æ³£ãã¨æ¶™ã¯ã©ã†ãªã‚‹ï¼Ÿ",c:["è½ã¡ã‚‹","è’¸ç™ºã™ã‚‹","ç›®ã«ç•™ã¾ã‚‹"],a:2},{q:"1å††ç‰ã®ç›´å¾„ã¯ä½•cmï¼Ÿ",c:["1cm","2cm","3cm"],a:1},{q:"ç«æ˜ŸãŒèµ¤ã„ç†ç”±ã¯ï¼Ÿ",c:["ç«ãŒã‚ã‚‹","éŒ†ã³ãŸé‰„ãŒã‚ã‚‹","æš‘ã„ã‹ã‚‰"],a:1},{q:"åœ°çƒã®è‡ªè»¢ã€1æ™‚é–“ã¯ä½•åº¦ï¼Ÿ",c:["10åº¦","15åº¦","24åº¦"],a:1},{q:"é¢ç©ãŒä¸–ç•Œä¸€ã®å›½ã¯ï¼Ÿ",c:["ã‚«ãƒŠãƒ€","ã‚¢ãƒ¡ãƒªã‚«","ãƒ­ã‚·ã‚¢"],a:2},{q:"ãƒãƒãƒ¥ãƒ”ãƒãƒ¥ãŒã‚ã‚‹å›½ã¯ï¼Ÿ",c:["ãƒšãƒ«ãƒ¼","ãƒãƒª","ãƒ¡ã‚­ã‚·ã‚³"],a:0},{q:"ä½“ã§ä¸€ç•ªç¡¬ã„éƒ¨åˆ†ã¯ã©ã“ï¼Ÿ",c:["é ­ã®éª¨","æ­¯ã®ã‚¨ãƒŠãƒ¡ãƒ«è³ª","å¤§è…¿éª¨"],a:1},{q:"é›²ã®æˆåˆ†ã¯ä½•ï¼Ÿ",c:["ç…™","æ°´ã‚„æ°·ã®ç²’","ç©ºæ°—"],a:1},{q:"ãƒ•ãƒ©ãƒ³ã‚¹ã®é¦–éƒ½ã¯ï¼Ÿ",c:["ãƒ™ãƒ«ãƒªãƒ³","ãƒ­ãƒ³ãƒ‰ãƒ³","ãƒ‘ãƒª"],a:2},{q:"å…‰ãŒæœˆã«å±Šãæ™‚é–“ã¯ï¼Ÿ",c:["ç´„1.3ç§’","ç´„8åˆ†","ç´„1æ™‚é–“"],a:0},{q:"èµ¤ã¡ã‚ƒã‚“ã®éª¨ã®æ•°ã¯å¤§äººã‚ˆã‚Šï¼Ÿ",c:["å¤šã„","å°‘ãªã„","åŒã˜"],a:0},{q:"ä¸–ç•Œä¸€é•·ã„å·ã¯ï¼Ÿ",c:["ã‚¢ãƒã‚¾ãƒ³å·","ãƒŠã‚¤ãƒ«å·","é•·æ±Ÿ"],a:1},{q:"é‡‘ã¯éŒ†ã³ã‚‹ï¼Ÿ",c:["éŒ†ã³ã‚‹","éŒ†ã³ãªã„","æ¡ä»¶æ¬¡ç¬¬"],a:1},{q:"äº”è¼ªæ——ã®å·¦ç«¯ã®è‰²ã¯ï¼Ÿ",c:["é’è‰²","é»„è‰²","èµ¤è‰²"],a:0},{q:"æ—¥æœ¬ä¸€åºƒã„æ¹–ã¯ï¼Ÿ",c:["éœãƒ¶æµ¦","çµç¶æ¹–","ã‚µãƒ­ãƒæ¹–"],a:1},{q:"å¤ªé™½è¡¨é¢ã®æ¸©åº¦ã¯ç´„ä½•åº¦ï¼Ÿ",c:["1000åº¦","6000åº¦","100ä¸‡åº¦"],a:1},{q:"ãƒ”ã‚¢ãƒã®éµç›¤ã®æ•°ã¯ï¼Ÿ",c:["80å€‹","88å€‹","92å€‹"],a:1},{q:"è™¹ã®ä¸€ç•ªä¸Šã®è‰²ã¯ï¼Ÿ",c:["ç´«è‰²","èµ¤è‰²","é»„è‰²"],a:1},{q:"é›·ã®éŸ³é€Ÿã¯1ç§’é–“ã«ç´„ä½•mï¼Ÿ",c:["340m","30ä¸‡km","1km"],a:0},{q:"æ—¥æœ¬æœ€å—ç«¯ã®å³¶ã¯ï¼Ÿ",c:["æ²–ãƒé³¥å³¶","ä¸é‚£å›½å³¶","ç«¹å¯Œå³¶"],a:0},{q:"ã‚¨ãƒƒãƒ•ã‚§ãƒ«å¡”ãŒã‚ã‚‹è¡—ã¯ï¼Ÿ",c:["ãƒ­ãƒ¼ãƒ","ãƒ‘ãƒª","ãƒãƒ‰ãƒªãƒ¼ãƒ‰"],a:1},{q:"ãƒˆãƒ©ãƒ³ãƒ—åˆè¨ˆ(JæŠœã)ã¯ï¼Ÿ",c:["364","365","366"],a:1},{q:"å¿ƒè‡“ã¯1æ—¥ã«ç´„ä½•å›æ‰“ã¤ï¼Ÿ",c:["1ä¸‡å›","5ä¸‡å›","10ä¸‡å›"],a:2},{q:"1å††ç‰ã¯ç´”ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ï¼Ÿ",c:["ãã†ã§ã™","é•ã„ã¾ã™","æ··åˆã§ã™"],a:0},{q:"ç©ºæ°—ã«ä¸€ç•ªå¤šã„æ°—ä½“ã¯ï¼Ÿ",c:["é…¸ç´ ","äºŒé…¸åŒ–ç‚­ç´ ","çª’ç´ "],a:2},{q:"ãƒãƒãƒŸãƒ„ã¯è…ã‚‹ï¼Ÿ",c:["è…ã‚‰ãªã„","è…ã‚‹","åŠå¹´ã§è…ã‚‹"],a:0},{q:"å—æ¥µã¨åŒ—æ¥µã©ã£ã¡ãŒå¯’ã„ï¼Ÿ",c:["å—æ¥µ","åŒ—æ¥µ","åŒã˜ãã‚‰ã„"],a:0},{q:"è‡ªç”±ã®å¥³ç¥ãŒæŒã¤ã®ã¯ï¼Ÿ",c:["è–æ›¸","ç‹¬ç«‹å®£è¨€æ›¸","æ†²æ³•"],a:1},{q:"ã‚¢ã‚¤ãƒ³ã‚·ãƒ¥ã‚¿ã‚¤ãƒ³ã®è³ã¯ï¼Ÿ",c:["ç‰©ç†å­¦è³","åŒ–å­¦è³","å¹³å’Œè³"],a:0},{q:"æœ€å¤šã®è¡€æ¶²å‹ã¯ä¸–ç•Œã§ï¼Ÿ",c:["Aå‹","Bå‹","Oå‹"],a:2},{q:"ãƒ‘ãƒ³ã®èªæºã¯ä½•èªï¼Ÿ",c:["è‹±èª","ãƒ•ãƒ©ãƒ³ã‚¹èª","ãƒãƒ«ãƒˆã‚¬ãƒ«èª"],a:2},{q:"5å††ç‰ã«ç©´ãŒã‚ã‚‹ç†ç”±ã¯ï¼Ÿ",c:["ææ–™ç¯€ç´„","ç´ã‚’é€šã™","å½é€ é˜²æ­¢"],a:0},{q:"1ãƒã‚¤ãƒ«ã¯ç´„ä½•ã‚­ãƒ­ï¼Ÿ",c:["1km","1.6km","2km"],a:1}],
        boss: [{q:"å…‰ã¯1ç§’ã§åœ°çƒã‚’ä½•å‘¨ã™ã‚‹ï¼Ÿ",c:["ç´„3å‘¨","ç´„7.5å‘¨","ç´„10å‘¨"],a:1},{q:"å°†æ£‹ã§è£è¿”ã£ã¦ã‚‚åä¸å¤‰ãªã®ã¯ï¼Ÿ",c:["é£›è»Š","è§’è¡Œ","ç‹å°†"],a:2},{q:"åŸå­ç•ªå·1ç•ªã®å…ƒç´ ã¯ï¼Ÿ",c:["ãƒ˜ãƒªã‚¦ãƒ ","æ°´ç´ ","ãƒªãƒã‚¦ãƒ "],a:1},{q:"ãƒãƒªã‚¢ãƒŠæµ·æºã®æ·±ã•ã¯ï¼Ÿ",c:["ç´„5000m","ç´„8000m","1ä¸‡mä»¥ä¸Š"],a:2},{q:"å¼•åŠ›ã‚’ç™ºè¦‹ã—ãŸãã£ã‹ã‘ã®æœç‰©ï¼Ÿ",c:["æ¡ƒ","ã‚ªãƒ¬ãƒ³ã‚¸","ãƒªãƒ³ã‚´"],a:2},{q:"æ—¥æœ¬ã®åˆä»£ç·ç†å¤§è‡£ã¯ï¼Ÿ",c:["ä¼Šè—¤åšæ–‡","ç¦æ²¢è«­å‰","ç¹”ç”°ä¿¡é•·"],a:0},{q:"ãƒ¢ãƒŠãƒªã‚¶ã®ä½œè€…ã¯èª°ï¼Ÿ",c:["ãƒ”ã‚«ã‚½","ãƒ€ãƒ´ã‚£ãƒ³ãƒ","ã‚´ãƒƒãƒ›"],a:1},{q:"1å…†ã®1000å€ã‚’ä½•ã¨å‘¼ã¶ï¼Ÿ",c:["å“","äº¬","ç©£"],a:1},{q:"å¤ªé™½ç³»æœ€å¤§ã®æƒ‘æ˜Ÿã¯ï¼Ÿ",c:["åœŸæ˜Ÿ","å¤©ç‹æ˜Ÿ","æœ¨æ˜Ÿ"],a:2},{q:"ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ãŒä½œã‚‰ã‚ŒãŸç›®çš„ã¯ï¼Ÿ",c:["å¤©æ–‡å°","ç‹ã®å¢“","ç©€ç‰©åº«"],a:1},{q:"ç¬¬ä¹ã®ä½œæ›²å®¶ã¯èª°ï¼Ÿ",c:["ãƒ™ãƒ¼ãƒˆãƒ¼ãƒ´ã‚§ãƒ³","ãƒ¢ãƒ¼ãƒ„ã‚¡ãƒ«ãƒˆ","ãƒãƒƒãƒ"],a:0},{q:"æœˆã®æº€ã¡æ¬ ã‘ã®å‘¨æœŸã¯ä½•æ—¥ï¼Ÿ",c:["28æ—¥","29.5æ—¥","31æ—¥"],a:1},{q:"æ˜­å’ŒåŸºåœ°ãŒã‚ã‚‹å ´æ‰€ã¯ï¼Ÿ",c:["å—æ¥µ","åŒ—æ¥µ","æœˆé¢"],a:0},{q:"ãƒãƒ¯ã‚¤ã¯ã‚¢ãƒ¡ãƒªã‚«ä½•ç•ªç›®ã®å·ï¼Ÿ",c:["48ç•ªç›®","49ç•ªç›®","50ç•ªç›®"],a:2},{q:"ã‚ªãƒ¼ãƒ­ãƒ©ãŒç™ºç”Ÿã™ã‚‹å±¤ã¯ï¼Ÿ",c:["å¯¾æµåœ","æˆå±¤åœ","ç†±åœ"],a:2},{q:"äººã¨DNAãŒ98%åŒã˜ãªã®ã¯ï¼Ÿ",c:["ã‚µãƒ«","ãƒ–ã‚¿","ãƒãƒ³ãƒ‘ãƒ³ã‚¸ãƒ¼"],a:2},{q:"å®‡å®™å‰µç”Ÿã®çˆ†ç™ºåã¯ï¼Ÿ",c:["ãƒ“ãƒƒã‚°ãƒãƒ³","ãƒãƒ´ã‚¡","ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«"],a:0},{q:"æœ€å°é¢ç©ã®å›½ã¯ã©ã“ï¼Ÿ",c:["ãƒ¢ãƒŠã‚³","ãƒãƒã‚«ãƒ³","ãƒŠã‚¦ãƒ«"],a:1},{q:"ãƒãƒ¼ãƒ™ãƒ«ãŒç™ºæ˜ã—ãŸã®ã¯ï¼Ÿ",c:["é›»çƒ","é›»è©±","ãƒ€ã‚¤ãƒŠãƒã‚¤ãƒˆ"],a:2},{q:"åœŸä¿µã®ç›´å¾„ã¯ä½•ãƒ¡ãƒ¼ãƒˆãƒ«ï¼Ÿ",c:["4.24m","4.55m","5m"],a:1},{q:"ä¸–ç•Œä¸€é«˜ã„ãƒ“ãƒ«ãŒã‚ã‚‹ã®ã¯ï¼Ÿ",c:["ãƒ‰ãƒã‚¤","ä¸Šæµ·","ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯"],a:0},{q:"å…‰ãŒ1å¹´é–“ã«é€²ã‚€è·é›¢ã‚’ä½•ã¨ã„ã†ï¼Ÿ",c:["1å…‰å¹´","1ãƒã‚¤ãƒ«","1ãƒ‘ãƒ¼ã‚»ã‚¯"],a:0},{q:"ã‚¤ã‚¿ãƒªã‚¢ã®ãƒ¦ãƒ¼ãƒ­å‰ã®é€šè²¨ã¯ï¼Ÿ",c:["ãƒ•ãƒ©ãƒ³","ãƒªãƒ©","ãƒãƒ«ã‚¯"],a:1},{q:"ã‚¢ãƒãƒ­11å·ãŒæœˆé¢ç€é™¸ã—ãŸå¹´ã¯ï¼Ÿ",c:["1964å¹´","1969å¹´","1972å¹´"],a:1},{q:"å°†æ£‹ç›¤ã®ãƒã‚¹ç›®ã¯å…¨éƒ¨ã§ã„ãã¤ï¼Ÿ",c:["64ãƒã‚¹","81ãƒã‚¹","100ãƒã‚¹"],a:1},{q:"æ±äº¬ã‚¿ãƒ¯ãƒ¼ã®é«˜ã•ã¯ä½•mï¼Ÿ",c:["300m","333m","634m"],a:1},{q:"ä¸–ç•Œä¸€é•·ã„å°èª¬ã¨ã•ã‚Œã‚‹ã®ã¯ï¼Ÿ",c:["æˆ¦äº‰ã¨å¹³å’Œ","å¤±ã‚ã‚ŒãŸæ™‚ã‚’æ±‚ã‚ã¦","æºæ°ç‰©èª"],a:1},{q:"é‡çƒä¸€è¾ºã®ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ã®é•·ã•ï¼Ÿ",c:["25m","27.4m","30m"],a:1},{q:"ä¸€å††ç‰ã®é‡ã•ã¯ä½•ã‚°ãƒ©ãƒ ï¼Ÿ",c:["1g","2g","5g"],a:0},{q:"æ—¥æœ¬ã®é‰„é“åˆèµ°è¡ŒåŒºé–“ã¯ã©ã“ï¼Ÿ",c:["æ–°æ©‹ã‹ã‚‰æ¨ªæµœ","ä¸Šé‡ã‹ã‚‰æµ…è‰","æ±äº¬ã‹ã‚‰å¤§é˜ª"],a:0},{q:"å¯Œå£«å±±ã®é«˜ã•ã¯ä½•ãƒ¡ãƒ¼ãƒˆãƒ«ï¼Ÿ",c:["3333m","3776m","4000m"],a:1},{q:"æ˜Ÿåº§ã®æ•°ã¯å…¨éƒ¨ã§ã„ãã¤ï¼Ÿ",c:["12æ˜Ÿåº§","48æ˜Ÿåº§","88æ˜Ÿåº§"],a:2}]
    };

    let hp = 100, eHp = 100, score = 0, mochi = 3, streak = 0, defCount = 0, totalCorrect = 0, maxStreakThisTurn = 0;
    let timerId = null, currentPool = JSON.parse(JSON.stringify(masterQuizData));

    function startGame() {
        Object.values(sounds).forEach(s => { try{ s.play(); s.pause(); s.currentTime=0; }catch(e){} });
        sounds.vPromo.volume = 1.0; sounds.tick.volume = 1.0; sounds.comboSE.volume = 1.0; sounds.bgm.volume = 0.1; sounds.bgm.loop = true;
        document.getElementById('start-screen').style.display = 'none';
        sounds.bgm.play().catch(e => {});
        updateUI(); loadQuiz();
    }

    function loadQuiz() {
        if(hp <= 0) return;
        if(totalCorrect >= 100) { showAllClearScreen(); return; }

        let type = (defCount >= 10) ? "boss" : (defCount >= 4) ? "mid" : "weak";
        let pool = currentPool[type];
        if (pool.length === 0) {
             if(type === "weak") { defCount = 4; loadQuiz(); return; }
             else if(type === "mid") { defCount = 10; loadQuiz(); return; }
             else { showAllClearScreen(); return; }
        }

        let qIdx = Math.floor(Math.random() * pool.length);
        let q = pool.splice(qIdx, 1)[0];
        
        document.getElementById('enemy-thumb').src = "images/enemy_" + type + ".png";
        document.getElementById('main-illust').src = "images/gemini_zunda_think.png";
        document.getElementById('question-box').innerText = q.q;
        const container = document.getElementById('choices');
        container.innerHTML = "";
        q.c.forEach((choice, i) => {
            const btn = document.createElement('button');
            btn.className = "choice-btn"; btn.innerText = choice;
            btn.onclick = () => {
                clearInterval(timerId);
                if(i === q.a) {
                    streak++; totalCorrect++;
                    if(streak > maxStreakThisTurn) maxStreakThisTurn = streak;
                    score += (100 + (streak > 1 ? streak * 25 : 0));
                    eHp -= 25; 
                    if (eHp > 0) {
                        sounds.ok.play().catch(e=>{});
                        setTimeout(() => {
                            if (streak > 1) { sounds.comboSE.currentTime = 0; sounds.comboSE.play().catch(e=>{}); }
                            let voice = sounds["vCombo" + Math.min(streak, 4)];
                            if (voice) { voice.currentTime = 0; voice.play().catch(e=>{}); }
                        }, 400);
                        showComboPop();
                    }
                    document.getElementById('main-illust').src = "images/gemini_attack_weak.png";
                } else {
                    checkComboBonus();
                    streak = 0; maxStreakThisTurn = 0; hp -= 20; 
                    sounds.ng.play().catch(e=>{});
                    document.getElementById('main-illust').src = "images/gemini_damage_weak_comic.png";
                    document.getElementById('game-container').classList.add('shake-screen');
                    setTimeout(() => document.getElementById('game-container').classList.remove('shake-screen'), 300);
                }
                updateUI(); checkBattle();
            };
            container.appendChild(btn);
        });
        startTimer();
    }

    function checkComboBonus() {
        if(maxStreakThisTurn >= 4) {
            let bonus = maxStreakThisTurn * 500;
            score += bonus;
            const b = document.getElementById('bonus-pop-up');
            b.innerText = "MAX COMBO BONUS!\n+" + bonus + "pts";
            b.style.display = "block";
            setTimeout(() => { b.style.display = "none"; }, 1500);
        }
    }

    function startTimer() {
        clearInterval(timerId);
        let time = 100, lastTick = 100;
        timerId = setInterval(() => {
            time -= 1.0; document.getElementById('timer-bar').style.width = time + "%";
            if (Math.floor(time) < lastTick) { try{ sounds.tick.currentTime=0; sounds.tick.play(); }catch(e){} lastTick = Math.floor(time); }
            if(time <= 0) { checkComboBonus(); streak = 0; maxStreakThisTurn = 0; hp -= 20; updateUI(); loadQuiz(); }
        }, 100);
    }

    function updateUI() {
        const pFill = document.getElementById('player-hp-fill');
        if (pFill) {
            pFill.style.width = hp + "%";
            pFill.style.backgroundColor = hp > 60 ? "#7dc065" : (hp > 30 ? "#ffda44" : "#f47b7b");
        }
        const eFill = document.getElementById('enemy-hp-fill');
        if (eFill) {
            eFill.style.width = Math.max(0, eHp) + "%";
            eFill.style.backgroundColor = eHp > 60 ? "#7dc065" : (eHp > 30 ? "#ffda44" : "#f47b7b");
        }
        document.getElementById('score-val').innerText = score;
        document.getElementById('mochi-val').innerText = mochi;
        document.getElementById('correct-count').innerText = totalCorrect;

        const aura = document.getElementById('combo-aura');
        if (streak >= 4) {
            aura.style.opacity = "1";
            aura.style.animation = "aura-flicker " + (0.5 - Math.min(streak * 0.05, 0.4)) + "s infinite alternate";
            document.getElementById('game-container').style.backgroundColor = "#fff4e6";
        } else {
            aura.style.opacity = "0"; aura.style.animation = "none";
            document.getElementById('game-container').style.backgroundColor = "#fff";
        }
    }

    function checkBattle() {
        if(hp <= 0) { setTimeout(endGame, 1000); }
        else if(eHp <= 0) { 
            sounds.defeat.play().catch(e=>{});
            checkComboBonus();
            let hb = hp * 10, mb = mochi * 200, tb = 500 + hb + mb;
            score += tb; defCount++; eHp = 100; 
            alert("æ’ƒç ´ï¼\nHPãƒœãƒ¼ãƒŠã‚¹: " + hb + "\nã‚‚ã¡ãƒœãƒ¼ãƒŠã‚¹: " + mb + "\nè¨ˆ " + tb + "ç‚¹ç²å¾—ï¼"); 
            updateUI(); loadQuiz(); 
        } else { setTimeout(loadQuiz, 1300); }
    }

    function showComboPop() { 
        const p = document.getElementById('combo-pop'); 
        p.innerText = streak + " COMBO!"; p.style.opacity = "1"; 
        if(streak >= 4) p.classList.add('max-combo-active'); else p.classList.remove('max-combo-active');
        setTimeout(() => p.style.opacity = "0", 800); 
    }

    // â–¼â–¼â–¼ éŸ³å£°ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ â–¼â–¼â–¼
    function endGame() {
        clearInterval(timerId); sounds.bgm.pause(); 
        sounds.result.currentTime = 0; sounds.result.play().catch(e=>{});
        // çµæœç™ºè¡¨æ™‚ã«ãƒœã‚¤ã‚¹ã‚’å†ç”Ÿ
        setTimeout(() => { sounds.vPromo.currentTime = 0; sounds.vPromo.play().catch(e=>{}); }, 500);
        document.getElementById('final-score').innerText = score;
        saveRanking('rank-body');
        document.getElementById('result-screen').style.display = 'flex';
    }

    // â–¼â–¼â–¼ éŸ³å£°ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ â–¼â–¼â–¼
    function showAllClearScreen() {
        clearInterval(timerId); sounds.bgm.pause(); 
        sounds.result.currentTime = 0; sounds.result.play().catch(e=>{});
        // ã‚ªãƒ¼ãƒ«ã‚¯ãƒªã‚¢æ™‚ã«ä¸€ç•ªç››ã‚Šä¸ŠãŒã‚‹ãƒœã‚¤ã‚¹ã‚’å†ç”Ÿ
        setTimeout(() => { sounds.vCombo4.currentTime = 0; sounds.vCombo4.play().catch(e=>{}); }, 500);
        document.getElementById('clear-score').innerText = score;
        saveRanking('clear-rank-body');
        document.getElementById('all-clear-screen').style.display = 'flex';
    }

    function saveRanking(targetId) {
        let ranks = JSON.parse(localStorage.getItem('zunda_rankings')) || [];
        if (ranks.length < 3 || score > (ranks[ranks.length-1]?.score || 0)) {
            // â–¼â–¼â–¼ éŸ³å£°ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ â–¼â–¼â–¼
            // ãƒ©ãƒ³ã‚¯ã‚¤ãƒ³æ™‚ã«ãƒ•ã‚¡ãƒ³ãƒ•ã‚¡ãƒ¼ãƒ¬éŸ³ã‚’å†ç”Ÿ
            sounds.comboSE.currentTime = 0; sounds.comboSE.play().catch(e=>{});
            let n = prompt("ãƒ©ãƒ³ã‚¯ã‚¤ãƒ³ï¼ãŠåå‰ã¯ï¼Ÿ", "ãšã‚“ã åç„¡ã—");
            if (n) { ranks.push({name: n, score: score}); ranks.sort((a,b) => b.score - a.score); ranks = ranks.slice(0, 3); localStorage.setItem('zunda_rankings', JSON.stringify(ranks)); }
        }
        document.getElementById(targetId).innerHTML = ranks.map((r,i) => "<tr><td>"+(i+1)+"</td><td>"+r.name+"</td><td>"+r.score+"</td></tr>").join('');
    }

    document.getElementById('btn-start-game').onclick = startGame;
    document.getElementById('btn-mochi').onclick = function() {
        if(mochi > 0 && hp < 100) { mochi--; hp = Math.min(hp + 50, 100); sounds.heal.play().catch(e=>{}); updateUI(); }
    };
    document.getElementById('loading-msg').innerText = "æº–å‚™å®Œäº†ãªã®ã ï¼";
</script>
</body>
</html>