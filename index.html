<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ãšã‚“ã è±†çŸ¥è­˜RPG - ç™¾å•è€ä¹…ç·¨ãªã®ã </title>
    <style>
        body { background-color: #f0f0f0; margin: 0; display: flex; justify-content: center; height: 100vh; overflow: hidden; font-family: sans-serif; }
        #game-container { 
            width: 100%; max-width: 480px; height: 100%; background: #fff; 
            border: 12px solid #7dc065; box-sizing: border-box; display: flex; flex-direction: column; position: relative;
        }

        /* ãƒãƒˆãƒ«ã‚¨ãƒªã‚¢ï¼šæ°´è‰²èƒŒæ™¯ */
        #top-battle-area { 
            background-color: #bce6f9; flex: 1.2; 
            padding: calc(15px + env(safe-area-inset-top)) 15px 10px 15px; 
            display: flex; flex-direction: column; position: relative; 
        }

        /* ã‚«ãƒ—ã‚»ãƒ«å‹HPãƒãƒ¼ï¼ˆå…±é€šãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ */
        .status-pill { 
            background: #fff; border: 3px solid #000; border-radius: 40px; 
            padding: 5px 12px; display: flex; align-items: center; gap: 8px; 
            box-shadow: 0 4px 0 rgba(0,0,0,0.1); width: fit-content; 
        }
        .hp-bg { width: 80px; height: 10px; background: #eee; border-radius: 5px; border: 1px solid #999; overflow: hidden; }
        .hp-fill { height: 100%; width: 100%; transition: width 0.3s; background: #7dc065; }

        /* ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ©ã‚¹ãƒˆè¡¨ç¤º */
        #main-action-view { flex: 1; display: flex; justify-content: center; align-items: center; padding: 10px; position: relative; }
        #main-illust { width: 100%; max-height: 220px; object-fit: contain; border: 3px solid #333; background: #fff; }
        #combo-pop { position: absolute; top: 30%; left: 50%; transform: translateX(-50%); color: #ff9800; font-size: 40px; font-weight: bold; text-shadow: 3px 3px 0 #fff; opacity: 0; z-index: 100; transition: 0.3s; pointer-events: none; }

        /* ä¸‹éƒ¨UIï¼šæ“ä½œã‚¨ãƒªã‚¢ */
        #bottom-ui-area { flex: 1; background: #fff; border-top: 8px solid #7dc065; padding: 15px 20px; padding-bottom: env(safe-area-inset-bottom); }
        #timer-bg { width: 100%; height: 18px; background: #eee; border: 3px solid #333; border-radius: 10px; overflow: hidden; margin-bottom: 10px; }
        #timer-bar { height: 100%; width: 100%; background: #f47b7b; }
        #question-box { background: #333; color: #fff; border-radius: 15px; padding: 15px; text-align: center; font-size: 16px; font-weight: bold; min-height: 70px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; line-height: 1.4; }
        .choice-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .choice-btn { background: #fff; border: 3px solid #7dc065; border-radius: 12px; padding: 10px; font-weight: bold; font-size: 14px; cursor: pointer; box-shadow: 0 4px 0 #5a9e43; }
        .choice-btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #5a9e43; }

        /* ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤º */
        .full-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.98); z-index:2000; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; padding:20px; box-sizing:border-box; overflow-y: auto; }
        .big-btn { padding: 15px 40px; font-size: 20px; font-weight: bold; background: #7dc065; color: white; border: none; border-radius: 40px; cursor: pointer; box-shadow: 0 6px 0 #5a9e43; margin-top: 10px; }
        
        /* ã‚¹ã‚¿ãƒ³ãƒ—å®£ä¼èµ¤æ  */
        #promo-box { border: 6px solid #f47b7b; border-radius: 15px; padding: 10px; background: #fff; margin-bottom: 15px; width: 100%; box-sizing: border-box; }
        
        /* ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ */
        .rank-table { width: 100%; margin: 10px 0; border-collapse: collapse; font-size: 14px; }
        .rank-table th { background: #7dc065; color: white; padding: 5px; }
        .rank-table td { border-bottom: 1px solid #ddd; padding: 5px; font-weight: bold; }

        .shake { animation: shake 0.5s; }
        @keyframes shake { 0%{transform:translate(2px,2px)} 25%{transform:translate(-3px,-2px)} 50%{transform:translate(3px,2px)} 100%{transform:translate(0,0)} }
    </style>
</head>
<body>

<div id="game-container">
    <div id="start-screen" class="full-overlay">
        <img src="images/game_title.png" style="width:90%; margin-bottom:20px; border:4px solid #7dc065; border-radius:15px;">
        <button class="big-btn" onclick="startGame()">å†’é™ºé–‹å§‹ãªã®ã ï¼</button>
        <p style="font-size:12px; color:#666; margin-top:10px;">(éŸ³ãŒæµã‚Œã‚‹ã®ã§æ³¨æ„ãªã®ã )</p>
    </div>

    <div id="result-screen" class="full-overlay" style="display:none;">
        <h2 style="margin:0; font-size:24px;">çµæœç™ºè¡¨ãªã®ã ï¼</h2>
        <div style="font-size:40px; font-weight:bold; color:#ff9800; margin:5px 0;"><span id="final-score">0</span>ç‚¹</div>
        
        <div id="promo-box">
            <p style="color:#f47b7b; font-weight:bold; margin:0 0 5px 0;">ã‚‚ã£ã¨ãšã‚“ã ã‚‚ã‚“ã—ã‚ƒã¹ã‚‹ã®ã ï¼</p>
            <a href="https://line.me/S/sticker/32533905?_from=lcm" target="_blank" style="text-decoration:none;">
                <img src="images/IMG_0294.PNG" style="width:100%; border-radius:5px;">
                <div style="background:#7dc065; color:white; padding:8px; border-radius:10px; margin-top:8px; font-weight:bold; font-size:14px;">ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¦‹ã‚‹ã®ã ï¼</div>
            </a>
        </div>

        <h3 style="margin:5px 0; font-size:16px;">ğŸ† æ­´ä»£ãƒˆãƒƒãƒ—3ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>
        <table class="rank-table">
            <thead><tr><th>ä½</th><th>åå‰</th><th>ç‚¹æ•°</th></tr></thead>
            <tbody id="rank-body"></tbody>
        </table>
        
        <button class="big-btn" onclick="location.reload()" style="background:#ffda44; color:#333; box-shadow:0 6px 0 #ccae36;">ã‚‚ã†ä¸€åº¦éŠã¶</button>
    </div>

    <div id="top-battle-area">
        <div id="enemy-status" class="status-pill">
            <img id="enemy-thumb" src="images/enemy_weak.png" style="width:30px; height:30px; object-fit:contain;">
            <div><div id="enemy-label" style="font-size:10px; color:#f47b7b; font-weight:bold;">ENEMY HP</div><div class="hp-bg"><div id="enemy-hp-fill" class="hp-fill"></div></div></div>
        </div>

        <div id="main-action-view">
            <div id="combo-pop">0 COMBO!</div>
            <img id="main-illust" src="images/gemini_zunda_think.png">
        </div>

        <div id="player-status" class="status-pill" style="align-self: center;">
            <img src="images/gemini_zunda_think.png" style="width:30px; height:30px; border-radius:50%; border:1px solid #7dc065;">
            <div><span style="color:red; font-weight:bold; font-size:12px;">zundamon</span><div class="hp-bg"><div id="player-hp-fill" class="hp-fill" style="background:#4caf50;"></div></div></div>
        </div>
    </div>

    <div id="bottom-ui-area">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <div onclick="useItem()" style="border:3px solid #7dc065; padding:4px 10px; border-radius:10px; font-weight:bold; cursor:pointer; background:#fff; font-size:16px;">ğŸ¡ x<span id="mochi-val">3</span></div>
            <div id="timer-bg"><div id="timer-bar"></div></div>
            <div style="font-size:16px; font-weight:bold; color:#ff9800;">SCORE: <span id="score-val">0</span></div>
        </div>
        <div id="question-box"></div>
        <div id="choices" class="choice-grid"></div>
    </div>
</div>

<script>
    const sounds = {
        bgm: new Audio('sounds/bgm_thinking.mp3'),
        result: new Audio('sounds/bgm_result.mp3'),
        ok: new Audio('sounds/se_correct.mp3'),
        ng: new Audio('sounds/se_damage.mp3'),
        tick: new Audio('sounds/se_tick.mp3'),
        vPromo: new Audio('sounds/voice_promo.mp3')
    };
    sounds.bgm.loop = true;

    let hp = 100, eHp = 100, score = 0, mochi = 3, streak = 0, defCount = 0;
    let timerId = null;

    // â˜…100å•ä»¥ä¸Šã®ã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿ãªã®ã ï¼
    const quizData = {
        weak: [
            {q:"ãƒ‘ãƒ³ãƒ€ã®å°»å°¾ã®è‰²ã¯ä½•è‰²ï¼Ÿ", c:["é»’","ç™½","ã—ã¾"], a:1},
            {q:"ã‚¤ãƒã‚´ã®è¡¨é¢ã«ã‚ã‚‹ãƒ„ãƒ–ãƒ„ãƒ–ã®æ­£ä½“ã¯ï¼Ÿ", c:["ç¨®","æœå®Ÿ","èŒ"], a:1},
            {q:"ãƒãƒŠãƒŠã¯ã€Œæœ¨ã€ã§ã¯ãªãä½•ã®ä»²é–“ï¼Ÿ", c:["è‰","ãƒ¤ã‚·","ã‚µãƒœãƒ†ãƒ³"], a:0},
            {q:"ã‚¿ã‚³ã®å¿ƒè‡“ã¯ã„ãã¤ã‚ã‚‹ï¼Ÿ", c:["1ã¤","2ã¤","3ã¤"], a:2},
            {q:"ã‚­ãƒªãƒ³ã®è§’ã¯ä½•æœ¬ã‚ã‚‹ï¼Ÿ", c:["2æœ¬","3æœ¬","5æœ¬"], a:2},
            {q:"ã‚·ãƒã‚¦ãƒã®åœ°è‚Œã®è‰²ã¯ä½•è‰²ï¼Ÿ", c:["ç™½","é»’","ãƒ”ãƒ³ã‚¯"], a:1},
            {q:"ã‚»ãƒŸãŒé³´ãã®ã¯ã©ã£ã¡ï¼Ÿ", c:["ã‚ªã‚¹","ãƒ¡ã‚¹","ä¸¡æ–¹"], a:0},
            {q:"ã‚³ã‚¢ãƒ©ãŒ1æ—¥ã«å¯ã‚‹æ™‚é–“ã¯ç´„ä½•æ™‚é–“ï¼Ÿ", c:["12æ™‚é–“","18æ™‚é–“","22æ™‚é–“"], a:2},
            {q:"ãƒ©ãƒƒã‚³ãŒå¯ã‚‹æ™‚ã«æµã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ã®ã¯ï¼Ÿ", c:["å²©ã‚’ã¤ã‹ã‚€","æµ·è—»ã‚’ä½“ã«å·»ã","æ‰‹ã‚’ç¹‹ã"], a:1},
            {q:"ä¸–ç•Œã§ä¸€ç•ªé€Ÿã„é³¥ã¯ã©ã‚Œï¼Ÿ", c:["ãƒãƒ¤ãƒ–ã‚µ","ãƒ€ãƒãƒ§ã‚¦","ãƒ„ãƒãƒ¡"], a:0},
            {q:"ãƒšãƒ³ã‚®ãƒ³ã®è†ã¯ã€å®Ÿã¯ã©ã†ãªã£ã¦ã„ã‚‹ï¼Ÿ", c:["ãªã„","æ›²ãŒã£ã¦ã„ã‚‹","ã¾ã£ã™ã"], a:1},
            {q:"ã‚«ãƒ©ã‚¹ã¯è‰²ã‚’è­˜åˆ¥ã§ãã‚‹ï¼Ÿ", c:["ã§ããªã„","å°‘ã—ã§ãã‚‹","äººé–“ã‚ˆã‚Šè¦‹ãˆã‚‹"], a:2},
            {q:"ãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼ãŒä¸€ç•ªæ „é¤ŠãŒã‚ã‚‹éƒ¨åˆ†ã¯ï¼Ÿ", c:["èŒ","ã¤ã¼ã¿","è‘‰"], a:0},
            {q:"çŒ«ã®è€³ã‚’å‹•ã‹ã™ç­‹è‚‰ã¯ã€äººé–“ã®ä½•å€ï¼Ÿ", c:["3å€","10å€","30å€"], a:2},
            {q:"ã‚¢ãƒªã®å¹³å‡çš„ãªå¯¿å‘½ã¯ã©ã‚Œãã‚‰ã„ï¼Ÿ", c:["æ•°é€±é–“","1ï½2å¹´","10å¹´ä»¥ä¸Š"], a:1},
            {q:"ã‚«ã‚¿ãƒ„ãƒ ãƒªã«ã¯æ­¯ãŒã‚ã‚‹ï¼Ÿ", c:["ãªã„","100æœ¬ãã‚‰ã„","1ä¸‡æœ¬ä»¥ä¸Š"], a:2},
            {q:"ã‚µãƒ¡ã®éª¨ã¯ä½•ã§ã§ãã¦ã„ã‚‹ï¼Ÿ", c:["ã‚«ãƒ«ã‚·ã‚¦ãƒ ","è»Ÿéª¨","é‰„åˆ†"], a:1},
            {q:"ä¸–ç•Œä¸€å¤§ãã„èŠ±ã€ãƒ©ãƒ•ãƒ¬ã‚·ã‚¢ã®åŒ‚ã„ã¯ï¼Ÿ", c:["ç”˜ã„","ç„¡è‡­","è…ã£ãŸè‚‰"], a:2},
            {q:"ãƒ’ãƒãƒ¯ãƒªã¯å¤ªé™½ã‚’ãšã£ã¨è¿½ã„ã‹ã‘ã‚‹ï¼Ÿ", c:["ãšã£ã¨è¿½ã†","è‹¥ã„æ™‚ã ã‘","è¿½ã‚ãªã„"], a:1},
            {q:"ãƒ¯ãƒ‹ã®æ€§åˆ¥ã¯ä½•ã§æ±ºã¾ã‚‹ï¼Ÿ", c:["éºä¼","åµã®æ™‚ã®æ¸©åº¦","é‹"], a:1},
            {q:"ã‚«ãƒ³ã‚¬ãƒ«ãƒ¼ã®èµ¤ã¡ã‚ƒã‚“ã€ç”Ÿã¾ã‚ŒãŸæ™‚ã®å¤§ãã•ã¯ï¼Ÿ", c:["ç´„2cm","ç´„10cm","ç´„30cm"], a:0},
            {q:"ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³ã®è‰²ãŒå¤‰ã‚ã‚‹ã®ã¯ä½•ã®ãŸã‚ï¼Ÿ", c:["éš ã‚Œã‚‹ãŸã‚","æ„Ÿæƒ…è¡¨ç¾","ä½“æ¸©èª¿ç¯€"], a:1},
            {q:"ãƒ•ã‚¯ãƒ­ã‚¦ã®é¦–ã¯ä½•åº¦å›ã‚‹ï¼Ÿ", c:["180åº¦","270åº¦","360åº¦"], a:1},
            {q:"ãƒ©ã‚¤ã‚ªãƒ³ã®ç‹©ã‚Šã‚’ã™ã‚‹ã®ã¯ä¸»ã«ã©ã£ã¡ï¼Ÿ", c:["ã‚ªã‚¹","ãƒ¡ã‚¹","å­ä¾›"], a:1},
            {q:"è±¡ãŒã‚¸ãƒ£ãƒ³ãƒ—ã§ããªã„å”¯ä¸€ã®å“ºä¹³é¡ã£ã¦æœ¬å½“ï¼Ÿ", c:["æœ¬å½“","å˜˜","ç¨®é¡ã«ã‚ˆã‚‹"], a:0},
            {q:"ãƒ›ãƒƒã‚­ãƒ§ã‚¯ã‚°ãƒã®åœ°è‚Œã®è‰²ã¯ä½•è‰²ï¼Ÿ", c:["ç™½","ãƒ”ãƒ³ã‚¯","é»’"], a:2},
            {q:"ãƒªã‚¹ã¯ã©ã‚“ãã‚Šã‚’åŸ‹ã‚ãŸå ´æ‰€ã‚’å…¨éƒ¨è¦šãˆã¦ã„ã‚‹ï¼Ÿ", c:["å…¨éƒ¨è¦šãˆã¦ã„ã‚‹","åŠåˆ†å¿˜ã‚Œã‚‹","ã»ã¨ã‚“ã©å¿˜ã‚Œã‚‹"], a:2},
            {q:"ã‚¦ã‚µã‚®ã®è€³ãŒé•·ã„æœ€å¤§ã®ç†ç”±ã¯ï¼Ÿ", c:["é ãã‚’èããŸã‚","ä½“æ¸©ã‚’é€ƒãŒã™ãŸã‚","å¯æ„›ã„ã‹ã‚‰"], a:1},
            {q:"æ—¥æœ¬ã§ä¸€ç•ªé«˜ã„å±±ã¯ï¼Ÿ", c:["å¯Œå£«å±±","åŒ—å²³","é˜¿è˜‡å±±"], a:0},
            {q:"èšŠã®ä¸»é£Ÿã¯ä½•ï¼Ÿ", c:["è¡€","èŠ±ã®èœœ","æ°´"], a:1},
            {q:"ã‚«ãƒã®æ±—ã®è‰²ã¯ä½•è‰²ã«è¦‹ãˆã‚‹ï¼Ÿ", c:["é€æ˜","é’","ãƒ”ãƒ³ã‚¯"], a:2},
            {q:"ä¸–ç•Œä¸€è¶³ãŒé€Ÿã„é™¸ä¸Šå‹•ç‰©ã¯ï¼Ÿ", c:["ãƒ©ã‚¤ã‚ªãƒ³","ãƒãƒ¼ã‚¿ãƒ¼","ã‚¬ã‚¼ãƒ«"], a:1},
            {q:"ãƒˆã‚¦ãƒ¢ãƒ­ã‚³ã‚·ã®ã²ã’ã®æ•°ã¯ä½•ã¨åŒã˜ï¼Ÿ", c:["è‘‰ã®æ•°","æ ¹ã®æ•°","ç²’ã®æ•°"], a:2},
            {q:"ãƒªãƒ³ã‚´ã‚’æ°´ã«æµ®ã‹ã¹ã‚‹ã¨ã©ã†ãªã‚‹ï¼Ÿ", c:["æ²ˆã‚€","æµ®ã","å›è»¢ã™ã‚‹"], a:1}
        ],
        mid: [
            {q:"ãƒ€ã‚¤ãƒ¤ãƒ¢ãƒ³ãƒ‰ã®æˆåˆ†ã¯ã€å®Ÿã¯ä½•ã¨åŒã˜ï¼Ÿ", c:["é‰„","ç‚­ç´ ","çŸ³ç°"], a:1},
            {q:"å®‡å®™ç©ºé–“ã§æ³£ãã¨ã€æ¶™ã¯ã©ã†ãªã‚‹ï¼Ÿ", c:["è½ã¡ã‚‹","è’¸ç™ºã™ã‚‹","ç›®ã«ç•™ã¾ã‚‹"], a:2},
            {q:"æ—¥æœ¬ã®1å††ç‰ã®ç›´å¾„ã¯ä½•ã‚»ãƒ³ãƒï¼Ÿ", c:["1cm","2cm","3cm"], a:1},
            {q:"ç«æ˜ŸãŒèµ¤ãè¦‹ãˆã‚‹ç†ç”±ã¯ï¼Ÿ", c:["ç«ãŒå¤šã„ã‹ã‚‰","éŒ†ã³ãŸé‰„ãŒã‚ã‚‹","æš‘ã„ã‹ã‚‰"], a:1},
            {q:"åœ°çƒã®è‡ªè»¢ã€1æ™‚é–“ã¯ä½•åº¦å›ã£ã¦ã„ã‚‹ï¼Ÿ", c:["10åº¦","15åº¦","24åº¦"], a:1},
            {q:"ä¸–ç•Œä¸€é¢ç©ãŒåºƒã„å›½ã¯ã©ã“ï¼Ÿ", c:["ã‚«ãƒŠãƒ€","ã‚¢ãƒ¡ãƒªã‚«","ãƒ­ã‚·ã‚¢"], a:2},
            {q:"ãƒãƒãƒ¥ãƒ”ãƒãƒ¥éºè·¡ãŒã‚ã‚‹å›½ã¯ã©ã“ï¼Ÿ", c:["ãƒšãƒ«ãƒ¼","ãƒãƒª","ãƒ¡ã‚­ã‚·ã‚³"], a:0},
            {q:"äººä½“ã§ä¸€ç•ªç¡¬ã„éƒ¨åˆ†ã¯ã©ã“ï¼Ÿ", c:["é ­ã®éª¨","æ­¯ã®ã‚¨ãƒŠãƒ¡ãƒ«è³ª","å¤ªã‚‚ã‚‚ã®éª¨"], a:1},
            {q:"é›²ã¯ä½•ã§ã§ãã¦ã„ã‚‹ï¼Ÿ", c:["ç…™","æ°´ã‚„æ°·ã®ç²’","ç©ºæ°—ã®å¡Š"], a:1},
            {q:"ãƒ•ãƒ©ãƒ³ã‚¹ã®é¦–éƒ½ã¯ã©ã“ï¼Ÿ", c:["ãƒ™ãƒ«ãƒªãƒ³","ãƒ­ãƒ³ãƒ‰ãƒ³","ãƒ‘ãƒª"], a:2},
            {q:"å…‰ãŒåœ°çƒã‹ã‚‰æœˆã¾ã§å±Šãæ™‚é–“ã¯ï¼Ÿ", c:["ç´„1.3ç§’","ç´„8åˆ†","ç´„1æ™‚é–“"], a:0},
            {q:"äººé–“ã®éª¨ã®æ•°ã¯ã€èµ¤ã¡ã‚ƒã‚“ã®æ–¹ãŒå¤§äººã‚ˆã‚Šå¤šã„ï¼Ÿ", c:["æœ¬å½“","å˜˜","åŒã˜"], a:0},
            {q:"ä¸–ç•Œã§ä¸€ç•ªé•·ã„å·ã¯ï¼Ÿ", c:["ã‚¢ãƒã‚¾ãƒ³å·","ãƒŠã‚¤ãƒ«å·","ãƒŸã‚·ã‚·ãƒƒãƒ”å·"], a:1},
            {q:"é‡‘ï¼ˆã‚´ãƒ¼ãƒ«ãƒ‰ï¼‰ã¯éŒ†ã³ã‚‹ï¼Ÿ", c:["éŒ†ã³ã‚‹","éŒ†ã³ãªã„","æ¡ä»¶ã«ã‚ˆã‚‹"], a:1},
            {q:"ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯ã®äº”è¼ªã€ä¸€ç•ªå·¦ã®è‰²ã¯ï¼Ÿ", c:["é’","é»„è‰²","èµ¤"], a:0},
            {q:"æ—¥æœ¬ã§ä¸€ç•ªåºƒã„æ¹–ã¯ï¼Ÿ", c:["éœãƒ¶æµ¦","çµç¶æ¹–","ã‚µãƒ­ãƒæ¹–"], a:1},
            {q:"å¤ªé™½ã®è¡¨é¢æ¸©åº¦ã¯ç´„ä½•åº¦ï¼Ÿ", c:["1000åº¦","6000åº¦","100ä¸‡åº¦"], a:1},
            {q:"ãƒ”ã‚¢ãƒã®éµç›¤ã®æ•°ã¯å…¨éƒ¨ã§ã„ãã¤ï¼Ÿ", c:["80å€‹","88å€‹","92å€‹"], a:1},
            {q:"è™¹ã®è‰²ã€ä¸€ç•ªå¤–å´ï¼ˆä¸Šï¼‰ã¯ä½•è‰²ï¼Ÿ", c:["ç´«","èµ¤","é»„è‰²"], a:1},
            {q:"é›·ã®éŸ³ã®é€Ÿã•ã¯1ç§’é–“ã«ç´„ä½•ãƒ¡ãƒ¼ãƒˆãƒ«ï¼Ÿ", c:["340m","30ä¸‡km","1km"], a:0},
            {q:"æ—¥æœ¬æœ€å—ç«¯ã®å³¶ã¯ã©ã‚Œï¼Ÿ", c:["æ²–ãƒé³¥å³¶","ä¸é‚£å›½å³¶","ç«¹å¯Œå³¶"], a:0},
            {q:"ã‚¨ãƒƒãƒ•ã‚§ãƒ«å¡”ãŒã‚ã‚‹éƒ½å¸‚ã¯ï¼Ÿ", c:["ãƒ­ãƒ¼ãƒ","ãƒ‘ãƒª","ãƒãƒ‰ãƒªãƒ¼ãƒ‰"], a:1},
            {q:"ãƒˆãƒ©ãƒ³ãƒ—ã®åˆè¨ˆï¼ˆã‚¸ãƒ§ãƒ¼ã‚«ãƒ¼æŠœãï¼‰ã‚’å…¨éƒ¨è¶³ã™ã¨ï¼Ÿ", c:["364","365","366"], a:1},
            {q:"äººé–“ã®å¿ƒè‡“ã¯1æ—¥ã«ä½•å›æ‰“ã¤ï¼Ÿ", c:["ç´„1ä¸‡å›","ç´„5ä¸‡å›","ç´„10ä¸‡å›"], a:2},
            {q:"æ—¥æœ¬ã®1å††ç‰ã€ã‚¢ãƒ«ãƒŸ100ï¼…ã£ã¦æœ¬å½“ï¼Ÿ", c:["æœ¬å½“","å˜˜","éŠ…ã‚‚å…¥ã£ã¦ã„ã‚‹"], a:0},
            {q:"ç©ºæ°—ä¸­ã«ä¸€ç•ªå¤šã„æ°—ä½“ã¯ï¼Ÿ", c:["é…¸ç´ ","äºŒé…¸åŒ–ç‚­ç´ ","çª’ç´ "], a:2},
            {q:"ãƒãƒãƒŸãƒ„ã¯è…ã‚‰ãªã„ã¨è¨€ã‚ã‚Œã¦ã„ã‚‹ï¼Ÿ", c:["æœ¬å½“","å˜˜","1å¹´ã§è…ã‚‹"], a:0},
            {q:"å—æ¥µã¨åŒ—æ¥µã€ã©ã£ã¡ã®æ–¹ãŒå¯’ã„ï¼Ÿ", c:["å—æ¥µ","åŒ—æ¥µ","åŒã˜"], a:0},
            {q:"è‡ªç”±ã®å¥³ç¥ãŒæŒã£ã¦ã„ã‚‹ã®ã¯ï¼Ÿ", c:["è–æ›¸","ç‹¬ç«‹å®£è¨€æ›¸","æ†²æ³•"], a:1},
            {q:"ã‚¢ã‚¤ãƒ³ã‚·ãƒ¥ã‚¿ã‚¤ãƒ³ãŒå—è³ã—ãŸãƒãƒ¼ãƒ™ãƒ«è³ã¯ï¼Ÿ", c:["ç‰©ç†å­¦è³","åŒ–å­¦è³","å¹³å’Œè³"], a:0},
            {q:"è¡€æ¶²å‹ã€ä¸–ç•Œã§ä¸€ç•ªå¤šã„ã®ã¯ã©ã‚Œï¼Ÿ", c:["Aå‹","Bå‹","Oå‹"], a:2},
            {q:"ãƒ‘ãƒ³ã¯è‹±èªï¼Ÿ", c:["ã¯ã„","ã„ã„ãˆ","å®Ÿã¯æ—¥æœ¬èª"], a:1},
            {q:"æ—¥æœ¬ã®5å††ç‰ã®ç©´ã®ç†ç”±ã¯ï¼Ÿ", c:["ææ–™ç¯€ç´„","ç´ã‚’é€šã™ãŸã‚","å½é€ é˜²æ­¢"], a:0},
            {q:"1ãƒã‚¤ãƒ«ã¯ç´„ä½•ã‚­ãƒ­ãƒ¡ãƒ¼ãƒˆãƒ«ï¼Ÿ", c:["1km","1.6km","2km"], a:1}
        ],
        boss: [
            {q:"å…‰ã®é€Ÿã•ã¯1ç§’é–“ã«åœ°çƒä½•å‘¨åˆ†ï¼Ÿ", c:["ç´„3å‘¨","ç´„7å‘¨åŠ","ç´„10å‘¨"], a:1},
            {q:"å°†æ£‹ã®é§’ã§ã€å”¯ä¸€è£è¿”ã£ã¦ã‚‚åå‰ãŒå¤‰ã‚ã‚‰ãªã„ã®ã¯ï¼Ÿ", c:["é£›è»Š","è§’è¡Œ","ç‹å°†"], a:2},
            {q:"åŸå­ç•ªå·1ç•ªã®å…ƒç´ ã¯ä½•ï¼Ÿ", c:["ãƒ˜ãƒªã‚¦ãƒ ","æ°´ç´ ","ãƒªãƒã‚¦ãƒ "], a:1},
            {q:"ã‚·ã‚§ã‚¤ã‚¯ã‚¹ãƒ”ã‚¢ã®å››å¤§æ‚²åŠ‡ã€ãƒãƒ ãƒ¬ãƒƒãƒˆã€ã‚ªã‚»ãƒ­ã€ãƒªã‚¢ç‹ã¨ã‚ã¨ä¸€ã¤ã¯ï¼Ÿ", c:["ãƒ­ãƒŸã‚ªã¨ã‚¸ãƒ¥ãƒªã‚¨ãƒƒãƒˆ","ãƒã‚¯ãƒ™ã‚¹","ãƒ´ã‚§ãƒ‹ã‚¹ã®å•†äºº"], a:1},
            {q:"ä¸–ç•Œã§ä¸€ç•ªæ·±ã„æµ·æºã€ãƒãƒªã‚¢ãƒŠæµ·æºã®æ·±ã•ã¯ï¼Ÿ", c:["ç´„5000m","ç´„8000m","ç´„1ä¸‡mä»¥ä¸Š"], a:2},
            {q:"ãƒ‹ãƒ¥ãƒ¼ãƒˆãƒ³ãŒä¸‡æœ‰å¼•åŠ›ã‚’ç™ºè¦‹ã™ã‚‹ãã£ã‹ã‘ã¨ãªã£ãŸæœç‰©ã¯ï¼Ÿ", c:["æ¡ƒ","ã‚ªãƒ¬ãƒ³ã‚¸","ãƒªãƒ³ã‚´"], a:2},
            {q:"æ—¥æœ¬ã®åˆä»£å†…é–£ç·ç†å¤§è‡£ã¯ï¼Ÿ", c:["ä¼Šè—¤åšæ–‡","ç¦æ²¢è«­å‰","ç¹”ç”°ä¿¡é•·"], a:0},
            {q:"ãƒ¢ãƒŠãƒ»ãƒªã‚¶ã‚’æã„ãŸã®ã¯èª°ï¼Ÿ", c:["ãƒ”ã‚«ã‚½","ãƒ€ãƒ»ãƒ´ã‚£ãƒ³ãƒ","ã‚´ãƒƒãƒ›"], a:1},
            {q:"1å…†ã®1000å€ã‚’ä½•ã¨å‘¼ã¶ï¼Ÿ", c:["å“","äº¬","ç©£"], a:1},
            {q:"ãƒŠãƒãƒ¬ã‚ªãƒ³ãŒæœ€å¾Œã«æµã•ã‚ŒãŸå³¶ã¯ï¼Ÿ", c:["ã‚¨ãƒ«ãƒå³¶","ã‚»ãƒ³ãƒˆãƒ˜ãƒ¬ãƒŠå³¶","ã‚³ãƒ«ã‚·ã‚«å³¶"], a:1},
            {q:"å¤ªé™½ç³»ã§ä¸€ç•ªå¤§ãã„æƒ‘æ˜Ÿã¯ï¼Ÿ", c:["åœŸæ˜Ÿ","å¤©ç‹æ˜Ÿ","æœ¨æ˜Ÿ"], a:2},
            {q:"ãƒ”ãƒ©ãƒŸãƒƒãƒ‰ãŒä½œã‚‰ã‚ŒãŸä¸»ãªç›®çš„ã¯ï¼Ÿ", c:["å¤©æ–‡å°","ç‹ã®ãŠå¢“","ç©€ç‰©åº«"], a:1},
            {q:"ãƒ‘ãƒ³ãƒ€ãŒç¬¹ã‚’é£Ÿã¹ã‚‹ã®ã¯ã€å®Ÿã¯ã©ã†ã—ã¦ï¼Ÿ", c:["ç¾å‘³ã—ã„ã‹ã‚‰","ä»–ã«é£Ÿã¹ã‚‹ã‚‚ã®ãŒãªã„","éºä¼çš„è¦å› "], a:2},
            {q:"ãƒ™ãƒ¼ãƒˆãƒ¼ãƒ´ã‚§ãƒ³ãŒè€³ãŒèã“ãˆãªããªã£ã¦ã‹ã‚‰æ›¸ã„ãŸäº¤éŸ¿æ›²ã¯ï¼Ÿ", c:["ç¬¬5ç•ª(é‹å‘½)","ç¬¬6ç•ª(ç”°åœ’)","ç¬¬9ç•ª(åˆå”±)"], a:2},
            {q:"æœˆã®æº€ã¡æ¬ ã‘ã®å‘¨æœŸã¯ç´„ä½•æ—¥ï¼Ÿ", c:["28æ—¥","29.5æ—¥","31æ—¥"], a:1},
            {q:"æ—¥æœ¬æœ€åŒ—ç«¯ã®å²¬ã¯ã©ã“ï¼Ÿ", c:["è¥Ÿè£³å²¬","å®—è°·å²¬","ç´æ²™å¸ƒå²¬"], a:1},
            {q:"å—æ¥µã«ã‚ã‚‹æ—¥æœ¬ã®è¦³æ¸¬åŸºåœ°ã¨ã„ãˆã°ï¼Ÿ", c:["æ˜­å’ŒåŸºåœ°","å¹³æˆåŸºåœ°","å¤§å’ŒåŸºåœ°"], a:0},
            {q:"ãƒãƒ¯ã‚¤ã¯ã‚¢ãƒ¡ãƒªã‚«ã®ä½•ç•ªç›®ã®å·ï¼Ÿ", c:["48ç•ªç›®","49ç•ªç›®","50ç•ªç›®"], a:2},
            {q:"ä¸–ç•Œä¸‰å¤§ç¾å¥³ã€‚ã‚¯ãƒ¬ã‚ªãƒ‘ãƒˆãƒ©ã€æ¥Šè²´å¦ƒã¨èª°ï¼Ÿ", c:["å°é‡å°ç”º","ã‚¸ãƒ£ãƒ³ãƒŒãƒ»ãƒ€ãƒ«ã‚¯","ãƒãƒªãƒªãƒ³ãƒ»ãƒ¢ãƒ³ãƒ­ãƒ¼"], a:0},
            {q:"ã‚ªãƒ¼ãƒ­ãƒ©ãŒç™ºç”Ÿã™ã‚‹ã®ã¯å¤§æ°—ã®ã©ã®å±¤ï¼Ÿ", c:["å¯¾æµåœ","æˆå±¤åœ","ç†±åœ"], a:2},
            {q:"ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯ã®ç™ºç¥¥ã®åœ°ã¯ï¼Ÿ", c:["ãƒ­ãƒ¼ãƒ","ã‚¢ãƒ†ãƒ","ãƒ‘ãƒª"], a:1},
            {q:"äººé–“ã®DNAã®å¡©åŸºé…åˆ—ã€ãƒãƒ³ãƒ‘ãƒ³ã‚¸ãƒ¼ã¨ä½•ï¼…åŒã˜ï¼Ÿ", c:["ç´„80ï¼…","ç´„90ï¼…","ç´„98ï¼…ä»¥ä¸Š"], a:2},
            {q:"å®‡å®™ã®å§‹ã¾ã‚Šã¨ã•ã‚Œã‚‹çˆ†ç™ºç¾è±¡ã®åå‰ã¯ï¼Ÿ", c:["ãƒ“ãƒƒã‚°ãƒãƒ³","ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒãƒ´ã‚¡","ãƒ–ãƒ©ãƒƒã‚¯ãƒ›ãƒ¼ãƒ«"], a:0},
            {q:"ä¸–ç•Œã§ä¸€ç•ªé¢ç©ãŒå°ã•ã„å›½ã¯ï¼Ÿ", c:["ãƒ¢ãƒŠã‚³","ãƒãƒã‚«ãƒ³å¸‚å›½","ãƒŠã‚¦ãƒ«"], a:1},
            {q:"ã‚¢ãƒ¡ãƒªã‚«ã®åˆä»£å¤§çµ±é ˜ã¯ï¼Ÿ", c:["ãƒ¯ã‚·ãƒ³ãƒˆãƒ³","ãƒªãƒ³ã‚«ãƒ¼ãƒ³","ã‚±ãƒãƒ‡ã‚£"], a:0},
            {q:"ãƒãƒ¼ãƒ™ãƒ«è³ã®å‰µè¨­è€…ã€ãƒãƒ¼ãƒ™ãƒ«ãŒç™ºæ˜ã—ãŸã‚‚ã®ã¯ï¼Ÿ", c:["é›»çƒ","é›»è©±","ãƒ€ã‚¤ãƒŠãƒã‚¤ãƒˆ"], a:2},
            {q:"ã‚¤ã‚¿ãƒªã‚¢ã®é€šè²¨ã€ãƒ¦ãƒ¼ãƒ­ã®å‰ã«ä½¿ã‚ã‚Œã¦ã„ãŸã®ã¯ï¼Ÿ", c:["ãƒ•ãƒ©ãƒ³","ãƒªãƒ©","ãƒãƒ«ã‚¯"], a:1},
            {q:"ãƒ¢ãƒ¼ãƒ„ã‚¡ãƒ«ãƒˆã®ãƒŸãƒ‰ãƒ«ãƒãƒ¼ãƒ ã¯ï¼Ÿ", c:["ã‚¢ãƒãƒ‡ã‚¦ã‚¹","ã‚»ãƒã‚¹ãƒãƒ£ãƒ³","ãƒ«ãƒ¼ãƒˆãƒ´ã‚£ãƒ’"], a:0},
            {q:"ã‚¢ãƒãƒ­11å·ãŒæœˆé¢ç€é™¸ã«æˆåŠŸã—ãŸå¹´ã¯ï¼Ÿ", c:["1964å¹´","1969å¹´","1972å¹´"], a:1},
            {q:"å¤§ç›¸æ’²ã®åœŸä¿µã®ç›´å¾„ã¯ä½•ãƒ¡ãƒ¼ãƒˆãƒ«ä½•ã‚»ãƒ³ãƒï¼Ÿ", c:["4m24cm","4m55cm","5m"], a:1},
            {q:"ä¸–ç•Œä¸€é«˜ã„å»ºç‰©ã€ãƒ–ãƒ«ã‚¸ãƒ¥ãƒ»ãƒãƒªãƒ•ã‚¡ãŒã‚ã‚‹éƒ½å¸‚ã¯ï¼Ÿ", c:["ãƒ‰ãƒã‚¤","ä¸Šæµ·","ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯"], a:0},
            {q:"å…‰ãŒ1å¹´é–“ã«é€²ã‚€è·é›¢ã‚’ä½•ã¨å‘¼ã¶ï¼Ÿ", c:["1ãƒã‚¤ãƒ«","1å…‰å¹´","1ãƒ‘ãƒ¼ã‚»ã‚¯"], a:1}
        ]
    };

    function startGame() {
        // iPhoneéŸ³æºå¼·åˆ¶ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ
        Object.values(sounds).forEach(s => { s.play(); s.pause(); s.currentTime = 0; });
        sounds.bgm.play().catch(e => console.log("Sound error"));
        document.getElementById('start-screen').style.display = 'none';
        updateUI(); loadQuiz();
    }

    function loadQuiz() {
        if(hp <= 0) return;
        let type = (defCount >= 10) ? "boss" : (defCount >= 4) ? "mid" : "weak";
        let pool = quizData[type];
        let q = pool[Math.floor(Math.random() * pool.length)];
        
        document.getElementById('enemy-thumb').src = `images/enemy_${type}.png`;
        document.getElementById('enemy-label').innerText = type.toUpperCase() + " ENEMY";
        document.getElementById('main-illust').src = "images/gemini_zunda_think.png";
        
        document.getElementById('question-box').innerText = q.q;
        const container = document.getElementById('choices');
        container.innerHTML = "";
        q.c.forEach((choice, i) => {
            const btn = document.createElement('button');
            btn.className = "choice-btn";
            btn.innerText = choice;
            btn.onclick = () => {
                clearInterval(timerId);
                if(i === q.a) {
                    streak++;
                    let bonus = (streak > 1 ? streak * 25 : 0);
                    score += (100 + bonus);
                    eHp -= 34; sounds.ok.play();
                    document.getElementById('main-illust').src = "images/gemini_attack_weak.png";
                    if(streak > 1) showCombo();
                } else {
                    streak = 0; hp -= 25; sounds.ng.play();
                    document.getElementById('main-illust').src = "images/gemini_damage_weak_comic.png";
                    document.getElementById('game-container').classList.add('shake');
                    setTimeout(() => document.getElementById('game-container').classList.remove('shake'), 500);
                }
                updateUI();
                checkBattle();
            };
            container.appendChild(btn);
        });
        startTimer();
    }

    function startTimer() {
        clearInterval(timerId);
        let time = 100;
        timerId = setInterval(() => {
            time -= 0.9;
            document.getElementById('timer-bar').style.width = time + "%";
            if(Math.floor(time) % 10 === 0) sounds.tick.play();
            if(time <= 0) { clearInterval(timerId); streak = 0; hp -= 20; updateUI(); loadQuiz(); }
        }, 100);
    }

    function updateUI() {
        document.getElementById('player-hp-fill').style.width = hp + "%";
        document.getElementById('enemy-hp-fill').style.width = (eHp > 0 ? eHp : 0) + "%";
        document.getElementById('score-val').innerText = score;
        document.getElementById('mochi-val').innerText = mochi;
    }

    function useItem() {
        if(mochi > 0 && hp < 100) {
            mochi--; hp = Math.min(hp + 50, 100);
            sounds.ok.play(); updateUI(); alert("ãšã‚“ã é¤…ã§å›å¾©ï¼");
        }
    }

    function checkBattle() {
        if(hp <= 0) { setTimeout(endGame, 1000); }
        else if(eHp <= 0) { 
            score += 500; defCount++; eHp = 100; 
            alert("æ•µã‚’å€’ã—ãŸã®ã ï¼æ’ƒç ´ãƒœãƒ¼ãƒŠã‚¹ +500ç‚¹ï¼"); updateUI(); loadQuiz(); 
        }
        else { setTimeout(loadQuiz, 1300); }
    }

    function showCombo() {
        const pop = document.getElementById('combo-pop');
        pop.innerText = streak + " COMBO!"; pop.style.opacity = "1";
        setTimeout(() => pop.style.opacity = "0", 800);
    }

    function endGame() {
        sounds.bgm.pause(); sounds.result.play();
        document.getElementById('final-score').innerText = score;
        
        let ranks = JSON.parse(localStorage.getItem('zunda_rankings')) || [];
        if (ranks.length < 3 || score > ranks[ranks.length-1].score) {
            let name = prompt("ãƒ©ãƒ³ã‚­ãƒ³ã‚°å…¥ã‚Šãªã®ã ï¼åå‰ã‚’å…¥ã‚Œã¦ã»ã—ã„ã®ã ï¼š", "ãšã‚“ã åç„¡ã—");
            if (name) {
                ranks.push({name: name, score: score});
                ranks.sort((a,b) => b.score - a.score);
                ranks = ranks.slice(0, 3);
                localStorage.setItem('zunda_rankings', JSON.stringify(ranks));
            }
        }
        document.getElementById('rank-body').innerHTML = ranks.map((r,i) => `<tr><td>${i+1}</td><td>${r.name}</td><td>${r.score}</td></tr>`).join('');
        document.getElementById('result-screen').style.display = 'flex';
        setTimeout(() => sounds.vPromo.play(), 2500);
    }
</script>
</body>
</html>